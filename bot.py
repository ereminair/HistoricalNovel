import os
from lib2to3.fixes.fix_input import context

from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import (
    Application,
    CommandHandler,
    CallbackQueryHandler,
    ContextTypes,
    MessageHandler,
    filters
)
import logging
from dotenv import load_dotenv

load_dotenv()

logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO
)
logger = logging.getLogger(__name__)

game_data = {
    1: {
        "title": "üü• –¢–û–í–ê–†–ò–© –°–¢–ê–õ–ò–ù, –°–û–í–ï–¢–£–ï–¢–°–Ø –ù–ê–†–û–î!",
        "description": (
            "1945 –≥–æ–¥. –ü–æ–±–µ–¥–∞ –Ω–∞–¥ —Ñ–∞—à–∏–∑–º–æ–º –æ–¥–µ—Ä–∂–∞–Ω–∞, –Ω–æ –Ω–æ–≤—ã–π –≤—Ä–∞–≥ —É–∂–µ –ø–æ–¥–Ω–∏–º–∞–µ—Ç –≥–æ–ª–æ–≤—É ‚Äî –∞–º–µ—Ä–∏–∫–∞–Ω—Å–∫–∏–π –∏–º–ø–µ—Ä–∏–∞–ª–∏–∑–º.\n\n"
            "–¢–µ–±–µ –ø—Ä–µ–¥—Å—Ç–æ–∏—Ç:\n"
            "‚úÖ –ü—Ä–∏–Ω–∏–º–∞—Ç—å —Å—É–¥—å–±–æ–Ω–æ—Å–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è ‚Äî –æ—Ç —è–¥–µ—Ä–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã –¥–æ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä–µ–≤–æ–ª—é—Ü–∏–π\n"
            "‚úÖ –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞—Ç—å –º–µ–∂–¥—É –≤–æ–µ–Ω–Ω–æ–π –º–æ—â—å—é, —ç–∫–æ–Ω–æ–º–∏–∫–æ–π –∏ –≤–ª–∏—è–Ω–∏–µ–º\n"
            "‚úÖ –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∏—Å—Ö–æ–¥ –•–æ–ª–æ–¥–Ω–æ–π –≤–æ–π–Ω—ã ‚Äî —Ç—Ä–∏—É–º—Ñ —Å–æ—Ü–∏–∞–ª–∏–∑–º–∞ –∏–ª–∏ –ø–æ—Ä–∞–∂–µ–Ω–∏–µ –°–°–°–†\n\n"
            "–ö–∞–∫ –∏–≥—Ä–∞—Ç—å:\n\n"
            "–í—ã–±–∏—Ä–∞–π –≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–µ–π—Å—Ç–≤–∏–π (–∫–Ω–æ–ø–∫–∏ –≤–Ω–∏–∑—É)\n\n"
            "–°–ª–µ–¥–∏ –∑–∞ —Å–∫—Ä—ã—Ç—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏\n\n"
            "–î–æ–∂–∏–≤–∏ –¥–æ 1953 –≥–æ–¥–∞ –∏ —É–∑–Ω–∞–π, –∫–∞–∫–∏–º —Å—Ç–∞–ª –º–∏—Ä\n\n"
            "\"–ò—Å—Ç–æ—Ä–∏—è –Ω–µ –∑–Ω–∞–µ—Ç —Å–æ—Å–ª–∞–≥–∞—Ç–µ–ª—å–Ω–æ–≥–æ –Ω–∞–∫–ª–æ–Ω–µ–Ω–∏—è... –Ω–æ —Å–µ–≥–æ–¥–Ω—è –æ–Ω–∞ –≤ —Ç–≤–æ–∏—Ö —Ä—É–∫–∞—Ö!\""
        ),
        "welcome_message": "–í—ã–±–µ—Ä–∏—Ç–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–µ —Å–æ–±—ã—Ç–∏–µ –¥–ª—è –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã:",
        "choices": [
            {"text": "–ü–æ—Ç—Å–¥–∞–º—Å–∫–∞—è –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—è (1945)", "callback": "potsdam_conference"},
            {"text": "–§—É–ª—Ç–æ–Ω—Å–∫–∞—è —Ä–µ—á—å –ß–µ—Ä—á–∏–ª–ª—è (1946)", "callback": "churchill_speech"},
            {"text": "‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", "callback": "back_to_main"}
        ]
    },
    2: {
        "title": "–§—É–ª—Ç–æ–Ω—Å–∫–∞—è —Ä–µ—á—å –ß–µ—Ä—á–∏–ª–ª—è (1946)",
        "description": "–ú–∞—Ä—Ç 1946. –ß–µ—Ä—á–∏–ª–ª—å –ø—Ä–æ–∏–∑–Ω–æ—Å–∏—Ç –§—É–ª—Ç–æ–Ω—Å–∫—É—é —Ä–µ—á—å –æ ¬´–∂–µ–ª–µ–∑–Ω–æ–º –∑–∞–Ω–∞–≤–µ—Å–µ¬ª...",
        "choices": [
            {"text": "–†–µ–∑–∫–æ –æ—Å—É–¥–∏—Ç—å –≤ ¬´–ü—Ä–∞–≤–¥–µ¬ª", "callback": "choice_churchill_0", "effects": {"propaganda": 5}},
            {"text": "–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å", "callback": "choice_churchill_1", "effects": {"western_relations": 3}},
            {"text": "–¢–∞–π–Ω–æ –≥–æ—Ç–æ–≤–∏—Ç—å –±–µ—Ä–ª–∏–Ω—Å–∫–∏–π –∫—Ä–∏–∑–∏—Å", "callback": "choice_churchill_2",
             "effects": {"military": 7, "risk": 10}}
        ]
    },

    3: {
        "title": "–ü–æ—Ç—Å–¥–∞–º—Å–∫–∞—è –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—è (1945)",
        "description": (
            "–ò—é–ª—å 1945. –°–®–ê —Å–æ–æ–±—â–∏–ª–∏ –æ–± —É—Å–ø–µ—à–Ω–æ–º –∏—Å–ø—ã—Ç–∞–Ω–∏–∏ –∞—Ç–æ–º–Ω–æ–π –±–æ–º–±—ã. "
            "–¢–µ–ø–µ—Ä—å –°–°–°–† –¥–æ–ª–∂–µ–Ω –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å–≤–æ—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –≤ –Ω–æ–≤—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö.\n\n"
            "–í—ã–±–µ—Ä–∏—Ç–µ –∫—É—Ä—Å –¥–µ–π—Å—Ç–≤–∏–π:"
        ),
        "choices": [
            {
                "text": "‚ò¢Ô∏è –£—Å–∫–æ—Ä–∏—Ç—å —è–¥–µ—Ä–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É –ª—é–±–æ–π —Ü–µ–Ω–æ–π!",
                "effects": {
                    "military": +3,
                    "economy": -2,
                    "nuclear_research": +2
                },
                "result": (
                    "–ö 1949 –≥–æ–¥—É –°–°–°–† —Å–æ–∑–¥–∞–µ—Ç –∞—Ç–æ–º–Ω—É—é –±–æ–º–±—É, "
                    "–Ω–æ —ç–∫–æ–Ω–æ–º–∏–∫–∞ —Å—Ç—Ä–∞–¥–∞–µ—Ç –æ—Ç –ø–µ—Ä–µ–∫–æ—Å–∞ –≤ –≤–æ–µ–Ω–Ω—ã–π —Å–µ–∫—Ç–æ—Ä."
                ),
                "next_event": "–®–ø–∏–æ–Ω—Å–∫–∏–π —Å–∫–∞–Ω–¥–∞–ª (1946)"
            },
            {
                "text": "üïäÔ∏è –£–∫—Ä–µ–ø–∏—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—å –≤ –í–æ—Å—Ç–æ—á–Ω–æ–π –ï–≤—Ä–æ–ø–µ",
                "effects": {
                    "europe_influence": +2,
                    "us_relations": -3
                },
                "result": (
                    "–ö–æ–º–º—É–Ω–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –ø–µ—Ä–µ–≤–æ—Ä–æ—Ç—ã –≤ –ü–æ–ª—å—à–µ –∏ –ß–µ—Ö–æ—Å–ª–æ–≤–∞–∫–∏–∏. "
                    "–ë–µ—Ä–ª–∏–Ω —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è '–≥–æ—Ä—è—á–µ–π —Ç–æ—á–∫–æ–π' —Ö–æ–ª–æ–¥–Ω–æ–π –≤–æ–π–Ω—ã."
                ),
                "next_event": "–ë–µ—Ä–ª–∏–Ω—Å–∫–∏–π –∫—Ä–∏–∑–∏—Å (1948)"
            },
            {
                "text": "ü§ù –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –ó–∞–ø–∞–¥—É –ø–µ—Ä–µ–≥–æ–≤–æ—Ä—ã",
                "effects": {
                    "us_relations": +2,
                    "military": -1
                },
                "result": (
                    "–í—Ä–µ–º–µ–Ω–Ω–æ–µ –ø–æ—Ç–µ–ø–ª–µ–Ω–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–π —Å –°–®–ê. "
                    "–ê–º–µ—Ä–∏–∫–∞–Ω—Ü—ã –ø—Ä–µ–¥–ª–∞–≥–∞—é—Ç '–ü–ª–∞–Ω –ú–∞—Ä—à–∞–ª–ª–∞' –¥–ª—è –°–°–°–†."
                ),
                "next_event": "–ü–ª–∞–Ω –ú–∞—Ä—à–∞–ª–ª–∞ (1947)"
            }
        ]
    },
    4: {
        "title": "–®–ø–∏–æ–Ω—Å–∫–∏–π —Å–∫–∞–Ω–¥–∞–ª (1946)",
        "description": (
            "–ê–≥–µ–Ω—Ç—ã –¶–†–£ –ø—ã—Ç–∞—é—Ç—Å—è —É–∫—Ä–∞—Å—Ç—å —è–¥–µ—Ä–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã –°–°–°–†. –ö–∞–∫ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —É–≥—Ä–æ–∑—É?"
        ),
        "choices": [
            {
                "text": "üïµÔ∏è –†–∞—Å—Å—Ç—Ä–µ–ª—è—Ç—å –≤—Å–µ—Ö –ø–æ–¥–æ–∑—Ä–µ–≤–∞–µ–º—ã—Ö!",
                "effects": {
                    "nuclear_research": +1,
                    "economy": -1
                },
                "result": (
                    "–ü—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–º–µ–¥–ª—è–µ—Ç—Å—è –∏–∑-–∑–∞ —Ä–µ–ø—Ä–µ—Å—Å–∏–π, –Ω–æ —É—Ç–µ—á–∫–∏ –ø—Ä–µ–∫—Ä–∞—â–∞—é—Ç—Å—è."
                ),
                "next_event": "–ò—Å–ø—ã—Ç–∞–Ω–∏–µ –†–î–°-1 (1949)"
            },
            {
                "text": "üîÑ –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–∑–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é",
                "effects": {
                    "europe_influence": +1,
                    "us_relations": -2
                },
                "result": (
                    "–°–®–ê —Ç—Ä–∞—Ç—è—Ç —Ä–µ—Å—É—Ä—Å—ã –Ω–∞ –ª–æ–∂–Ω—ã–µ —Ü–µ–ª–∏, –Ω–æ —É—Å–∏–ª–∏–≤–∞—é—Ç —Ä–∞–∑–≤–µ–¥–∫—É."
                ),
                "next_event": "–æ–ø–µ—Ä–∞—Ü–∏—è_–≤–µ–Ω–æ–Ω–∞"
            }
        ]
    },
    5: {
        "title": "–ë–µ—Ä–ª–∏–Ω—Å–∫–∏–π –∫—Ä–∏–∑–∏—Å (1948)",
        "description": (
            "–ó–∞–ø–∞–¥–Ω—ã–µ —Å–æ—é–∑–Ω–∏–∫–∏ –≤–≤–æ–¥—è—Ç –Ω–æ–≤—É—é –≤–∞–ª—é—Ç—É –≤ –ó–∞–ø–∞–¥–Ω–æ–º –ë–µ—Ä–ª–∏–Ω–µ. "
            "–ö–∞–∫ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ —ç—Ç–æ—Ç –≤—ã–∑–æ–≤?"
        ),
        "choices": [
            {
                "text": "üöß –ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –≥–æ—Ä–æ–¥!",
                "effects": {
                    "military": +2,
                    "economy": -1
                },
                "check": lambda stats: stats.get('europe_influence', 0) >= 0,
                "result": (
                    "–í—ã –≤–≤–æ–¥–∏—Ç–µ –±–ª–æ–∫–∞–¥—É –ó–∞–ø–∞–¥–Ω–æ–≥–æ –ë–µ—Ä–ª–∏–Ω–∞. "
                    "{}"
                ),
                "next_event": "—Å–æ–∑–¥–∞–Ω–∏–µ_–Ω–∞—Ç–æ"
            },
            {
                "text": "üí£ –£–≥—Ä–æ–∂–∞—Ç—å —è–¥–µ—Ä–Ω—ã–º —É–¥–∞—Ä–æ–º",
                "effects": {
                    "nuclear_research": +3,
                    "us_relations": -5
                },
                "result": "–¢—Ä—É–º—ç–Ω –≤—ã–¥–≤–∏–≥–∞–µ—Ç —É–ª—å—Ç–∏–º–∞—Ç—É–º. –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è —Ä–∞–Ω–Ω–∏–π –ö–∞—Ä–∏–±—Å–∫–∏–π –∫—Ä–∏–∑–∏—Å.",
                "next_event": "–ö–∞—Ä–∏–±—Å–∫–∏–π –∫—Ä–∏–∑–∏—Å (1950)"
            }
        ]
    },
    6: {
        "title": "–ü–ª–∞–Ω –ú–∞—Ä—à–∞–ª–ª–∞ (1947)",
        "description": (
            "–°–®–ê –ø—Ä–µ–¥–ª–∞–≥–∞—é—Ç –°–°–°–† —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫—É—é –ø–æ–º–æ—â—å –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —ç–∫–æ–Ω–æ–º–∏–∫–∏.\n\n"
            "–ö–∞–∫ –æ—Ç—Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å?"
        ),
        "choices": [
            {
                "text": "üíµ –ü—Ä–∏–Ω—è—Ç—å –ø–æ–º–æ—â—å",
                "effects": {
                    "economy": +4,
                    "europe_influence": -3
                },
                "result": (
                    "–°–°–°–† –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–æ–º–æ—â—å –°–®–ê. "
                    "–ö–∏—Ç–∞–π –∏ –Æ–≥–æ—Å–ª–∞–≤–∏—è –æ—Å—É–∂–¥–∞—é—Ç –°–æ–≤–µ—Ç—Å–∫–∏–π –°–æ—é–∑. "
                    "–í–ª–∏—è–Ω–∏–µ –≤ —Å–æ—Ü–∏–∞–ª–∏—Å—Ç–∏—á–µ—Å–∫–æ–º –ª–∞–≥–µ—Ä–µ –ø–∞–¥–∞–µ—Ç."
                ),
                "next_event": "—Ä–∞—Å–∫–æ–ª_—Å_—Ç–∏—Ç–æ"
            },
            {
                "text": "üö´ –û—Ç–∫–∞–∑–∞—Ç—å—Å—è –∏ —Å–æ–∑–¥–∞—Ç—å –ö–æ–º–∏–Ω—Ñ–æ—Ä–º",
                "effects": {
                    "europe_influence": +2,
                    "economy": -2
                },
                "result": (
                    "–°–°–°–† –æ—Ç–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ—Ç –ü–ª–∞–Ω–∞ –ú–∞—Ä—à–∞–ª–ª–∞ –∏ —Å–æ–∑–¥–∞–µ—Ç –ö–æ–º–∏–Ω—Ñ–æ—Ä–º, "
                    "–æ–±—ä–µ–¥–∏–Ω—è—è —Å–æ—Ü–∏–∞–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ç—Ä–∞–Ω—ã –ø–æ–¥ —Å–≤–æ–∏–º –∫–æ–Ω—Ç—Ä–æ–ª–µ–º. "
                    "–≠–∫–æ–Ω–æ–º–∏–∫–∞ —Å—Ç—Ä–∞–¥–∞–µ—Ç –æ—Ç –∏–∑–æ–ª—è—Ü–∏–∏."
                ),
                "next_event": "berlin_crisis"
            }
        ]
    },
    7: {
            "title": "–ö–∞—Ä–∏–±—Å–∫–∏–π –∫—Ä–∏–∑–∏—Å (1950)",
            "description": (
                "–°–®–ê —Ä–∞–∑–º–µ—Å—Ç–∏–ª–∏ —Ä–∞–∫–µ—Ç—ã –≤ –¢—É—Ä—Ü–∏–∏. –í –æ—Ç–≤–µ—Ç –°–°–°–† —Ä–µ—à–∞–µ—Ç —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å —Å–≤–æ–∏ —Ä–∞–∫–µ—Ç—ã –Ω–∞ –ö—É–±–µ.\n\n"
                "–ö–∞–∫ –ø—Ä–æ–≤–µ—Å—Ç–∏ –æ–ø–µ—Ä–∞—Ü–∏—é?"
            ),
            "choices": [
                {
                    "text": "‚ò¢Ô∏è –†–∞–∑–º–µ—Å—Ç–∏—Ç—å —Ä–∞–∫–µ—Ç—ã —Ç–∞–π–Ω–æ",
                    "check": lambda stats: stats.get('nuclear_research', 0) > 0,
                    "effects": {
                        "military": +3
                    },
                    "result": (
                        "–°–®–ê –Ω–µ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞—é—Ç —Ä–∞–∫–µ—Ç—ã. –°–°–°–† –ø–æ–ª—É—á–∞–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ. "
                        "–ê–º–µ—Ä–∏–∫–∞ –≤ –ø–∞–Ω–∏–∫–µ, –∫–æ–≥–¥–∞ —Ñ–∞–∫—Ç —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∏–∑–≤–µ—Å—Ç–µ–Ω."
                    ),
                    "next_event": "–¥–æ–≥–æ–≤–æ—Ä_–æ_–∑–∞–ø—Ä–µ—Ç–µ_–∏—Å–ø—ã—Ç–∞–Ω–∏–π"
                },
                {
                    "text": "üí• –û—Ç–∫—Ä—ã—Ç–∞—è –∫–æ–Ω—Ñ—Ä–æ–Ω—Ç–∞—Ü–∏—è",
                    "effects": {
                        "us_relations": -10
                    },
                    "result": (
                        "–ú–∏—Ä –Ω–∞ –≥—Ä–∞–Ω–∏ —è–¥–µ—Ä–Ω–æ–π –≤–æ–π–Ω—ã. –ì–ª–æ–±–∞–ª—å–Ω–∞—è –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞ –Ω–µ–∏–∑–±–µ–∂–Ω–∞. "
                        "–í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏ –•–æ–ª–æ–¥–Ω—É—é –≤–æ–π–Ω—É."
                    ),
                    "is_final": True
                }
            ]
    },
    8: {
        "title": "–ò—Å–ø—ã—Ç–∞–Ω–∏–µ –†–î–°-1 (1949)",
        "description": (
            "29 –∞–≤–≥—É—Å—Ç–∞ 1949 –≥–æ–¥–∞. –°–°–°–† —É—Å–ø–µ—à–Ω–æ –∏—Å–ø—ã—Ç–∞–ª –ø–µ—Ä–≤—É—é –∞—Ç–æ–º–Ω—É—é –±–æ–º–±—É –Ω–∞ –°–µ–º–∏–ø–∞–ª–∞—Ç–∏–Ω—Å–∫–æ–º –ø–æ–ª–∏–≥–æ–Ω–µ.\n\n"
            "–¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ —Ä–µ—à–∏—Ç—å, –∫–∞–∫ —Å–æ–æ–±—â–∏—Ç—å –æ–± —ç—Ç–æ–º –º–∏—Ä—É:"
        ),
        "choices": [
            {
                "text": "‚ò¢Ô∏è –ü—É–±–ª–∏—á–Ω–æ –æ–±—ä—è–≤–∏—Ç—å –æ–± —É—Å–ø–µ—Ö–µ",
                "effects": {
                    "military": +4,
                    "us_relations": -3
                },
                "result": (
                    "–í–µ—Å—å –º–∏—Ä —É–∑–Ω–∞–µ—Ç –æ —Å–æ–≤–µ—Ç—Å–∫–æ–º —è–¥–µ—Ä–Ω–æ–º –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–µ. "
                    "–í–æ–µ–Ω–Ω—ã–π –ø—Ä–µ—Å—Ç–∏–∂ –°–°–°–† —Ä–∞—Å—Ç–µ—Ç, –Ω–æ –°–®–ê –≤ –æ—Ç–≤–µ—Ç —É—Å–∫–æ—Ä—è—é—Ç –≥–æ–Ω–∫—É –≤–æ–æ—Ä—É–∂–µ–Ω–∏–π "
                    "–∏ —Ä–∞–∑–º–µ—â–∞—é—Ç —è–¥–µ—Ä–Ω–æ–µ –æ—Ä—É–∂–∏–µ –≤ –ï–≤—Ä–æ–ø–µ."
                ),
                "next_event": "—Å–æ–∑–¥–∞–Ω–∏–µ_–Ω–∞—Ç–æ"
            },
            {
                "text": "üïµÔ∏è –°–∫—Ä—ã—Ç—å —Ñ–∞–∫—Ç –∏—Å–ø—ã—Ç–∞–Ω–∏—è",
                "effects": {
                    "nuclear_research": +2,
                    "europe_influence": -1
                },
                "result": (
                    "–ò—Å–ø—ã—Ç–∞–Ω–∏–µ –¥–µ—Ä–∂–∏—Ç—Å—è –≤ —Å–µ–∫—Ä–µ—Ç–µ, –Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç —Å–æ–º–Ω–µ–Ω–∏—è —É —Å–æ—é–∑–Ω–∏–∫–æ–≤. "
                    "–ß–µ—Ä–µ–∑ 6 –º–µ—Å—è—Ü–µ–≤ –¶–†–£ —É–∑–Ω–∞–µ—Ç –ø—Ä–∞–≤–¥—É, —á—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç –≤–ª–∏—è–Ω–∏–µ –°–°–°–†."
                ),
                "next_event": "–æ–ø–µ—Ä–∞—Ü–∏—è_–≤–µ–Ω–æ–Ω–∞"
            }
        ]
    },
    9: {
        "title": "–û–ø–µ—Ä–∞—Ü–∏—è '–í–µ–Ω–æ–Ω–∞' (1948/1950)",
        "description": (
            "–ê–º–µ—Ä–∏–∫–∞–Ω—Å–∫–∞—è —Ä–∞–∑–≤–µ–¥–∫–∞ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç —à–∏—Ñ—Ä–æ–≤–∫–∏ —Å–æ–≤–µ—Ç—Å–∫–∏—Ö –∞–≥–µ–Ω—Ç–æ–≤. "
            "–ù–∞—á–∏–Ω–∞–µ—Ç—Å—è –º–∞—Å—à—Ç–∞–±–Ω–æ–µ —Ä–∞–∑–æ–±–ª–∞—á–µ–Ω–∏–µ —à–ø–∏–æ–Ω—Å–∫–æ–π —Å–µ—Ç–∏.\n\n"
            "–ö–∞–∫ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —É—Ç–µ—á–∫—É?"
        ),
        "choices": [
            {
                "text": "üîÑ –ó–∞–º–µ—Å—Ç–∏ —Å–ª–µ–¥—ã",
                "effects": {
                    "europe_influence": +1,
                    "economy": -1
                },
                "result": (
                    "–°–°–°–† –ø–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —à–∏—Ñ—Ä–æ–≤–∞–ª—å–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∞–≥–µ–Ω—Ç—É—Ä—É. "
                    "–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∞–≥–µ–Ω—Ç–æ–≤ –∏–∑–±–µ–≥–∞—é—Ç —Ä–∞–∑–æ–±–ª–∞—á–µ–Ω–∏—è, –Ω–æ –æ–ø–µ—Ä–∞—Ü–∏—è –æ–±—Ö–æ–¥–∏—Ç—Å—è –¥–æ—Ä–æ–≥–æ."
                ),
                "next_event": "–¥–µ–ª–æ_—Ä–æ–∑–µ–Ω–±–µ—Ä–≥–æ–≤"
            },
            {
                "text": "üíÄ –õ–∏–∫–≤–∏–¥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ—Ö —Å–≤—è–∑–∞–Ω–Ω—ã—Ö",
                "effects": {
                    "us_relations": +2,
                    "military": -1
                },
                "result": (
                    "–°–°–°–† —É–Ω–∏—á—Ç–æ–∂–∞–µ—Ç —Å–µ—Ç—å —à–ø–∏–æ–Ω–∞–∂–∞ –≤ –°–®–ê. "
                    "–ê–º–µ—Ä–∏–∫–∞–Ω—Ü—ã —Ç–µ—Ä—è—é—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∏, –Ω–æ –°–°–°–† —Ç–µ—Ä—è–µ—Ç —Ü–µ–Ω–Ω—ã—Ö —É—á—ë–Ω—ã—Ö –∏ –∏–Ω–∂–µ–Ω–µ—Ä–æ–≤."
                ),
                "next_event": "–æ—Ç—Å—Ç–∞–≤–∞–Ω–∏–µ_–≤_–≥–æ–Ω–∫–µ"
            }
        ]
    },
    10: {
        "title": "–°–æ–∑–¥–∞–Ω–∏–µ –ù–ê–¢–û (1949)",
        "description": (
            "–ó–∞–ø–∞–¥–Ω—ã–µ —Å—Ç—Ä–∞–Ω—ã —Å–æ–∑–¥–∞—é—Ç –°–µ–≤–µ—Ä–æ–∞—Ç–ª–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –∞–ª—å—è–Ω—Å –¥–ª—è —Å–¥–µ—Ä–∂–∏–≤–∞–Ω–∏—è –°–°–°–†.\n\n"
            "–ö–∞–∫ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ —ç—Ç—É —É–≥—Ä–æ–∑—É?"
        ),
        "choices": [
            {
                "text": "üõ°Ô∏è –°–æ–∑–¥–∞—Ç—å –û–í–î –¥–æ—Å—Ä–æ—á–Ω–æ",
                "effects": {
                    "military": +3,
                    "economy": -2
                },
                "result": (
                    "–°–°–°–† –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –¥–æ—Å—Ä–æ—á–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –í–∞—Ä—à–∞–≤—Å–∫–æ–≥–æ –¥–æ–≥–æ–≤–æ—Ä–∞. "
                    "–í–æ–µ–Ω–Ω—ã–π –±–ª–æ–∫ —Å–æ—Ü—Å—Ç—Ä–∞–Ω —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è, –Ω–æ –≤–æ–∑—Ä–∞—Å—Ç–∞—é—Ç –≤–æ–µ–Ω–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã."
                ),
                "next_event": "–≤–µ–Ω–≥–µ—Ä—Å–∫–æ–µ_–≤–æ—Å—Å—Ç–∞–Ω–∏–µ"
            },
            {
                "text": "üì¢ –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –ø—Ä–æ–ø–∞–≥–∞–Ω–¥—É –ø—Ä–æ—Ç–∏–≤ –ù–ê–¢–û",
                "effects": {
                    "europe_influence": +2,
                    "us_relations": -3
                },
                "result": (
                    "–°–æ–≤–µ—Ç—Å–∫–∞—è –ø—Ä–æ–ø–∞–≥–∞–Ω–¥–∞ –Ω–∞—Ä–∞—â–∏–≤–∞–µ—Ç –∞–Ω—Ç–∏–∞–º–µ—Ä–∏–∫–∞–Ω—Å–∫—É—é —Ä–∏—Ç–æ—Ä–∏–∫—É. "
                    "–í–æ –º–Ω–æ–≥–∏—Ö —Å—Ç—Ä–∞–Ω–∞—Ö –ï–≤—Ä–æ–ø—ã –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è –º–∏—Ä–Ω—ã–µ –ø—Ä–æ—Ç–µ—Å—Ç—ã –ø—Ä–æ—Ç–∏–≤ –ù–ê–¢–û."
                ),
                "next_event": "—Å—Ç–æ–∫–≥–æ–ª—å–º—Å–∫–∞—è_–∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—è"
            }
        ]
    },
    11: {
        "title": "–†–∞—Å–∫–æ–ª —Å –¢–∏—Ç–æ (1948)",
        "description": (
            "–Æ–≥–æ—Å–ª–∞–≤—Å–∫–∏–π –ª–∏–¥–µ—Ä –ò–æ—Å–∏—Ñ –ë—Ä–æ–∑ –¢–∏—Ç–æ –æ—Å—É–∂–¥–∞–µ—Ç —Å–±–ª–∏–∂–µ–Ω–∏–µ –°–°–°–† —Å –ó–∞–ø–∞–¥–æ–º "
            "–∏ –æ–±–≤–∏–Ω—è–µ—Ç –°—Ç–∞–ª–∏–Ω–∞ –≤ –ø—Ä–µ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–µ –∏–¥–µ–∞–ª–æ–≤ —Å–æ—Ü–∏–∞–ª–∏–∑–º–∞.\n\n"
            "–ö–∞–∫ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –∫—Ä–∏—Ç–∏–∫—É —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã —Å–æ—é–∑–Ω–∏–∫–∞?"
        ),
        "choices": [
            {
                "text": "‚úä –û–±—ä—è–≤–∏—Ç—å –¢–∏—Ç–æ –ø—Ä–µ–¥–∞—Ç–µ–ª–µ–º",
                "effects": {
                    "europe_influence": +1,
                    "economy": -2
                },
                "result": (
                    "–°–°–°–† –∏—Å–∫–ª—é—á–∞–µ—Ç –Æ–≥–æ—Å–ª–∞–≤–∏—é –∏–∑ —Å–æ—Ü–∏–∞–ª–∏—Å—Ç–∏—á–µ—Å–∫–æ–≥–æ –ª–∞–≥–µ—Ä—è. "
                    "–ö–æ–º–∏–Ω—Ñ–æ—Ä–º —Å–æ–∑–¥–∞–Ω –¥–ª—è —É–∫—Ä–µ–ø–ª–µ–Ω–∏—è –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã. –î—Ä—É–≥–∏–µ –ª–∏–¥–µ—Ä—ã –±–æ—è—Ç—Å—è –≤—ã—Å—Ç—É–ø–∞—Ç—å –ø—Ä–æ—Ç–∏–≤ –ú–æ—Å–∫–≤—ã."
                ),
                "next_event": "–∞–ª–±–∞–Ω—Å–∫–∏–π_—Ä–∞—Å–∫–æ–ª"
            },
            {
                "text": "ü§ù –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –ø—Ä–∏–º–∏—Ä–∏—Ç—å—Å—è",
                "effects": {
                    "europe_influence": -3,
                    "economy": +1
                },
                "result": (
                    "–°–°–°–† –∏–¥—ë—Ç –Ω–∞ —É—Å—Ç—É–ø–∫–∏ –Æ–≥–æ—Å–ª–∞–≤–∏–∏. –ö–∏—Ç–∞–π –Ω–∞—á–∏–Ω–∞–µ—Ç –ø—Ä–æ–≤–æ–¥–∏—Ç—å —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—É—é –ø–æ–ª–∏—Ç–∏–∫—É, "
                    "–ø–æ–¥—Ä—ã–≤–∞—è –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç –ú–æ—Å–∫–≤—ã –≤ —Å–æ—Ü–ª–∞–≥–µ—Ä–µ."
                ),
                "is_final": True,
                "outcome_key": "fragmentation"
            }
        ]
    },
    12: {
        "title": "–î–æ–≥–æ–≤–æ—Ä –æ –∑–∞–ø—Ä–µ—Ç–µ –∏—Å–ø—ã—Ç–∞–Ω–∏–π (1963)",
        "description": (
            "–ü–æ—Å–ª–µ —Ç–∞–π–Ω–æ–≥–æ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —Ä–∞–∫–µ—Ç –Ω–∞ –ö—É–±–µ –∏ –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∫—Ä–∏–∑–∏—Å–∞, "
            "–°–°–°–† –∏ –°–®–ê –≤—Å—Ç—É–ø–∞—é—Ç –≤ –ø–µ—Ä–µ–≥–æ–≤–æ—Ä—ã –ø–æ —Å–¥–µ—Ä–∂–∏–≤–∞–Ω–∏—é –≥–æ–Ω–∫–∏ –≤–æ–æ—Ä—É–∂–µ–Ω–∏–π.\n\n"
            "–ù–∞ –ø–æ–≤–µ—Å—Ç–∫–µ –¥–Ω—è ‚Äî –∑–∞–ø—Ä–µ—Ç —è–¥–µ—Ä–Ω—ã—Ö –∏—Å–ø—ã—Ç–∞–Ω–∏–π –≤ –∞—Ç–º–æ—Å—Ñ–µ—Ä–µ, –ø–æ–¥ –≤–æ–¥–æ–π –∏ –≤ –∫–æ—Å–º–æ—Å–µ."
        ),
        "choices": [
            {
                "text": "üìù –ü–æ–¥–ø–∏—Å–∞—Ç—å –¥–æ–≥–æ–≤–æ—Ä",
                "effects": {
                    "us_relations": +3,
                    "nuclear_research": -1
                },
                "result": (
                    "–°–°–°–† –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –¥–µ—ç—Å–∫–∞–ª–∞—Ü–∏–∏. –°–®–ê –∏–¥—É—Ç –Ω–∞–≤—Å—Ç—Ä–µ—á—É. "
                    "–ù–∞—á–∏–Ω–∞–µ—Ç—Å—è —ç–ø–æ—Ö–∞ —Ä–∞–∑—Ä—è–¥–∫–∏. –ú–∏—Ä –≤–¥–æ—Ö–Ω—É–ª —Å –æ–±–ª–µ–≥—á–µ–Ω–∏–µ–º."
                ),
                "is_final": True
            },
            {
                "text": "‚ùå –û—Ç–∫–∞–∑–∞—Ç—å—Å—è –æ—Ç —Å–æ–≥–ª–∞—à–µ–Ω–∏—è",
                "effects": {
                    "military": +2,
                    "us_relations": -2
                },
                "result": (
                    "–°–°–°–† –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –∏—Å–ø—ã—Ç–∞–Ω–∏—è. –°–®–ê –æ–±–≤–∏–Ω—è—é—Ç –≤ –ø—Ä–æ–≤–æ–∫–∞—Ü–∏—è—Ö. "
                    "–•–æ–ª–æ–¥–Ω–∞—è –≤–æ–π–Ω–∞ —É—Å–∏–ª–∏–≤–∞–µ—Ç—Å—è, –Ω–æ –°–°–°–† —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å."
                ),
                "is_final": True
            }
        ]
    },
    13: {
        "title": "–°—Ç–æ–∫–≥–æ–ª—å–º—Å–∫–∞—è –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—è (1951)",
        "description": (
            "–ú–∏—Ä–Ω—ã–µ –∞–∫—Ç–∏–≤–∏—Å—Ç—ã –ï–≤—Ä–æ–ø—ã —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –≤ –®–≤–µ—Ü–∏–∏, —á—Ç–æ–±—ã –æ–±—Å—É–¥–∏—Ç—å —É–≥—Ä–æ–∑—É —è–¥–µ—Ä–Ω–æ–π –≤–æ–π–Ω—ã. "
            "–°–°–°–† –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç –¥–ª—è –ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–æ–π –≤—ã–≥–æ–¥—ã."
        ),
        "choices": [
            {
                "text": "üïäÔ∏è –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –¥–≤–∏–∂–µ–Ω–∏–µ –∑–∞ –º–∏—Ä",
                "effects": {
                    "us_relations": +2,
                    "europe_influence": +1
                },
                "result": (
                    "–°–°–°–† –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ —Å—Ç–æ—Ä–æ–Ω–Ω–∏–∫ –º–∏—Ä–∞. –ü—Ä–æ–ø–∞–≥–∞–Ω–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ. "
                    "–û—Ç–Ω–æ—à–µ–Ω–∏—è —Å –ó–∞–ø–∞–¥–æ–º –≤—Ä–µ–º–µ–Ω–Ω–æ —É–ª—É—á—à–∞—é—Ç—Å—è."
                ),
                "is_final": True,
                "outcome_key": "stalemate"
            },
            {
                "text": "üõë –û–±–≤–∏–Ω–∏—Ç—å –ó–∞–ø–∞–¥ –≤ –ª–∏—Ü–µ–º–µ—Ä–∏–∏",
                "effects": {
                    "us_relations": -3,
                    "military": +2
                },
                "result": (
                    "–°–æ–≤–µ—Ç—Å–∫–∞—è –ø—Ä–µ—Å—Å–∞ –≥—Ä–æ–º–∏—Ç –ó–∞–ø–∞–¥ –∑–∞ –¥–≤–æ–π–Ω—ã–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã. "
                    "–≠—Å–∫–∞–ª–∞—Ü–∏—è –Ω–∞–ø—Ä—è–∂—ë–Ω–Ω–æ—Å—Ç–∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è."
                ),
                "is_final": True,
                "outcome_key": "global_war"
            }
        ]
    },
    14: {
        "title": "–í–µ–Ω–≥–µ—Ä—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–∏–µ (1956)",
        "description": (
            "–í –ë—É–¥–∞–ø–µ—à—Ç–µ –≤—Å–ø—ã—Ö–∏–≤–∞—é—Ç –ø—Ä–æ—Ç–µ—Å—Ç—ã –ø—Ä–æ—Ç–∏–≤ —Å–æ–≤–µ—Ç—Å–∫–æ–≥–æ –≤–ª–∏—è–Ω–∏—è. "
            "–ù–∞—Ä–æ–¥ —Ç—Ä–µ–±—É–µ—Ç —Ä–µ—Ñ–æ—Ä–º. –°–°–°–† –¥–æ–ª–∂–µ–Ω —Ä–µ—à–∏—Ç—å: –ø–æ–¥–∞–≤–∏—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–∏–µ –∏–ª–∏ —É—Å—Ç—É–ø–∏—Ç—å."
        ),
        "choices": [
            {
                "text": "üí• –í–≤–µ—Å—Ç–∏ –≤–æ–π—Å–∫–∞ –∏ –ø–æ–¥–∞–≤–∏—Ç—å",
                "effects": {
                    "military": -1,
                    "europe_influence": -2
                },
                "result": (
                    "–ê—Ä–º–∏—è –ø–æ–¥–∞–≤–ª—è–µ—Ç –ø—Ä–æ—Ç–µ—Å—Ç—ã. –ò–º–∏–¥–∂ –°–°–°–† —Å–µ—Ä—å—ë–∑–Ω–æ –ø–æ—Å—Ç—Ä–∞–¥–∞–ª. "
                    "–°–æ—Ü–ª–∞–≥–µ—Ä—å –Ω–∞—á–∏–Ω–∞–µ—Ç —Ç—Ä–µ—â–∞—Ç—å –ø–æ —à–≤–∞–º."
                ),
                "is_final": True,
                "outcome_key": "military_dominance"
            },
            {
                "text": "ü§ù –ü–æ–π—Ç–∏ –Ω–∞ —É—Å—Ç—É–ø–∫–∏",
                "effects": {
                    "europe_influence": -3,
                    "us_relations": +2
                },
                "result": (
                    "–°–°–°–† —Ä–∞–∑—Ä–µ—à–∞–µ—Ç —Ä–µ—Ñ–æ—Ä–º—ã. –°–®–ê —Ö–≤–∞–ª—è—Ç –≥–∏–±–∫–æ—Å—Ç—å –ö—Ä–µ–º–ª—è. "
                    "–ù–æ —Å—Ç—Ä–∞–Ω—ã –í–∞—Ä—à–∞–≤—Å–∫–æ–≥–æ –±–ª–æ–∫–∞ –Ω–∞—á–∏–Ω–∞—é—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å –±–æ–ª—å—à–µ–≥–æ."
                ),
                "is_final": True,
                "outcome_key": "stalemate"
            }
        ]
    },
    15: {
        "title": "–î–µ–ª–æ –†–æ–∑–µ–Ω–±–µ—Ä–≥–æ–≤ (1951)",
        "description": (
            "–í –°–®–ê –∞—Ä–µ—Å—Ç–æ–≤–∞–Ω—ã —Å—É–ø—Ä—É–≥–∏ –†–æ–∑–µ–Ω–±–µ—Ä–≥–∏, –ø–æ–¥–æ–∑—Ä–µ–≤–∞–µ–º—ã–µ –≤ –ø–µ—Ä–µ–¥–∞—á–µ —è–¥–µ—Ä–Ω—ã—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤ –°–°–°–†. "
            "–ú–∏—Ä —Å–ª–µ–¥–∏—Ç –∑–∞ —ç—Ç–∏–º –¥–µ–ª–æ–º. –ö–∞–∫ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –°–æ–≤–µ—Ç—Å–∫–∏–π –°–æ—é–∑?"
        ),
        "choices": [
            {
                "text": "üì£ –û–±—ä—è–≤–∏—Ç—å –∏—Ö –≥–µ—Ä–æ—è–º–∏ –º–∏—Ä–∞",
                "effects": {
                    "propaganda": +3,
                    "us_relations": -2
                },
                "result": (
                    "–°–°–°–† –∑–∞—â–∏—â–∞–µ—Ç –†–æ–∑–µ–Ω–±–µ—Ä–≥–æ–≤ –∫–∞–∫ –±–æ—Ä—Ü–æ–≤ –∑–∞ –º–∏—Ä. "
                    "–ó–∞–ø–∞–¥ –æ–±–≤–∏–Ω—è–µ—Ç –°–°–°–† –≤ –ø–æ–æ—â—Ä–µ–Ω–∏–∏ —à–ø–∏–æ–Ω–∞–∂–∞."
                ),
                "is_final": True,
                "outcome_key": "stalemate"
            },
            {
                "text": "ü§´ –û—Ç—Å—Ç—Ä–∞–Ω–∏—Ç—å—Å—è –æ—Ç –¥–µ–ª–∞",
                "effects": {
                    "us_relations": +1,
                    "europe_influence": -1
                },
                "result": (
                    "–°–°–°–† –ø—É–±–ª–∏—á–Ω–æ –Ω–µ –≤–º–µ—à–∏–≤–∞–µ—Ç—Å—è. –°–®–ê —Ç—Ä–∞–∫—Ç—É—é—Ç —ç—Ç–æ –∫–∞–∫ –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ –≤–∏–Ω—ã, "
                    "–Ω–æ –Ω–∞–ø—Ä—è–∂—ë–Ω–Ω–æ—Å—Ç—å –Ω–µ —Ä–∞—Å—Ç—ë—Ç."
                ),
                "is_final": True,
                "outcome_key": "stalemate"
            }
        ]
    },
    16: {
        "title": "–û—Ç—Å—Ç–∞–≤–∞–Ω–∏–µ –≤ –≥–æ–Ω–∫–µ (1952)",
        "description": (
            "–ü–æ—Å–ª–µ —Ä–µ–ø—Ä–µ—Å—Å–∏–π –∏ –ø—Ä–æ–≤–∞–ª–æ–≤ –≤ —à–ø–∏–æ–Ω–∞–∂–µ –°–°–°–† –Ω–∞—á–∏–Ω–∞–µ—Ç –æ—Ç—Å—Ç–∞–≤–∞—Ç—å –≤ —è–¥–µ—Ä–Ω–æ–π –≥–æ–Ω–∫–µ. "
            "–°–®–ê —Å–æ–∑–¥–∞—é—Ç –≤–æ–¥–æ—Ä–æ–¥–Ω—É—é –±–æ–º–±—É. –ß—Ç–æ –¥–µ–ª–∞—Ç—å?"
        ),
        "choices": [
            {
                "text": "üöÄ –£–¥–≤–æ–∏—Ç—å –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –≤ –ù–ò–û–ö–†",
                "effects": {
                    "nuclear_research": +3,
                    "economy": -2
                },
                "result": (
                    "–°–°–°–† —É—Å–∫–æ—Ä—è–µ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –≤–æ–¥–æ—Ä–æ–¥–Ω–æ–π –±–æ–º–±—ã. –≠–∫–æ–Ω–æ–º–∏–∫–∞ —Å—Ç—Ä–∞–¥–∞–µ—Ç, –Ω–æ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Ä–∞–∑—Ä—ã–≤ —Å–æ–∫—Ä–∞—â–∞–µ—Ç—Å—è."
                ),
                "is_final": True,
                "outcome_key": "economic_decline"
            },
            {
                "text": "ü§ù –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –ó–∞–ø–∞–¥—É –¥–æ–≥–æ–≤–æ—Ä",
                "effects": {
                    "us_relations": +2,
                    "military": -1
                },
                "result": (
                    "–°–°–°–† –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –ø–µ—Ä–µ–≥–æ–≤–æ—Ä—ã –ø–æ –∫–æ–Ω—Ç—Ä–æ–ª—é –Ω–∞–¥ –≤–æ–æ—Ä—É–∂–µ–Ω–∏—è–º–∏. "
                    "–í–∞—à–∏–Ω–≥—Ç–æ–Ω –∫–æ–ª–µ–±–ª–µ—Ç—Å—è, –Ω–æ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —É—á–∞—Å—Ç–∏–µ –≤ –æ–±—Å—É–∂–¥–µ–Ω–∏—è—Ö."
                ),
                "is_final": True,
                "outcome_key": "stalemate"
            }
        ]
    },
    17: {
        "title": "–ê–ª–±–∞–Ω—Å–∫–∏–π —Ä–∞—Å–∫–æ–ª (1950)",
        "description": (
            "–ü–æ—Å–ª–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ —Å –¢–∏—Ç–æ –ê–ª–±–∞–Ω–∏—è –≤—Å—Ç–∞–µ—Ç –ø–µ—Ä–µ–¥ –≤—ã–±–æ—Ä–æ–º: –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å –°–°–°–† –∏–ª–∏ —É–π—Ç–∏ –∫ –ö–∏—Ç–∞—é.\n\n"
            "–ö–∞–∫ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–æ—é–∑–Ω–∏–∫–∞?"
        ),
        "choices": [
            {
                "text": "üí∞ –ü–æ–¥–∫—É–ø–∏—Ç—å –∞–ª–±–∞–Ω—Å–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ",
                "effects": {
                    "economy": -1,
                    "europe_influence": +1
                },
                "result": (
                    "–°–°–°–† –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫—É—é –ø–æ–º–æ—â—å –ê–ª–±–∞–Ω–∏–∏. "
                    "–°–æ—é–∑ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö –∑–∞—Ç—Ä–∞—Ç."
                ),
                "is_final": True,
                "outcome_key": "economic_decline"
            },
            {
                "text": "üó°Ô∏è –°–º–µ–Ω–∏—Ç—å —Ä–µ–∂–∏–º –≤ –¢–∏—Ä–∞–Ω–µ",
                "effects": {
                    "military": -1,
                    "europe_influence": -2
                },
                "result": (
                    "–°–æ–≤–µ—Ç—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–≤–æ—Ä–æ—Ç–∞ –≤—ã–∑—ã–≤–∞–µ—Ç –æ—Å—É–∂–¥–µ–Ω–∏–µ. "
                    "–ê–ª–±–∞–Ω–∏—è —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–º —Å–æ—é–∑–Ω–∏–∫–æ–º."
                ),
                "is_final": True,
                "outcome_key": "military_dominance"
            }
        ]
    },


    99: {
        "title": "üìú –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∞—è —Å–ø—Ä–∞–≤–∫–∞",
        "description": "–í—ã–±–µ—Ä–∏—Ç–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–µ —Å–æ–±—ã—Ç–∏–µ:",
        "choices": [
            {"text": "–ü–æ—Ç—Å–¥–∞–º—Å–∫–∞—è –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—è (1945)", "callback": "history_potsdam"},
            {"text": "–§—É–ª—Ç–æ–Ω—Å–∫–∞—è —Ä–µ—á—å –ß–µ—Ä—á–∏–ª–ª—è (1946)", "callback": "history_churchill"},
            {"text": "–®–ø–∏–æ–Ω—Å–∫–∏–π —Å–∫–∞–Ω–¥–∞–ª (1946)", "callback": "history_spy"},
            {"text": "–ë–µ—Ä–ª–∏–Ω—Å–∫–∏–π –∫—Ä–∏–∑–∏—Å (1948)", "callback": "history_berlin"},
            {"text": "–ö–∞—Ä–∏–±—Å–∫–∏–π –∫—Ä–∏–∑–∏—Å (1962)", "callback": "history_cuban"},
            {"text": "–ò—Å–ø—ã—Ç–∞–Ω–∏–µ –†–î–°-1 (1949)", "callback": "history_rds1"},
            {"text": "–û–ø–µ—Ä–∞—Ü–∏—è '–í–µ–Ω–æ–Ω–∞' (1948/1950)", "callback": "history_venona"},
            {"text": "–†–∞—Å–∫–æ–ª —Å –¢–∏—Ç–æ (1948)", "callback": "history_tito"},
            {"text": "–î–æ–≥–æ–≤–æ—Ä –æ –∑–∞–ø—Ä–µ—Ç–µ –∏—Å–ø—ã—Ç–∞–Ω–∏–π (1963)", "callback": "history_testban"},
            {"text": "–°—Ç–æ–∫–≥–æ–ª—å–º—Å–∫–∞—è –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—è (1951)", "callback": "history_stockholm"},
            {"text": "–í–µ–Ω–≥–µ—Ä—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–∏–µ (1956)", "callback": "history_hungary"},
            {"text": "–î–µ–ª–æ –†–æ–∑–µ–Ω–±–µ—Ä–≥–æ–≤ (1951)", "callback": "history_rosenbergs"},
            {"text": "–ê–ª–±–∞–Ω—Å–∫–∏–π —Ä–∞—Å–∫–æ–ª (1950)", "callback": "history_albania"},

            {"text": "‚Ü©Ô∏è –ù–∞–∑–∞–¥", "callback": "back_to_main"}
        ]
    },

    "final_victory": {
        "title": "üèÜ –ü–æ–±–µ–¥–∞!",
        "description": (
            "üïØÔ∏è <b>–ú–∞—Ä—Ç 1953 –≥–æ–¥–∞. –°–º–µ—Ä—Ç—å –°—Ç–∞–ª–∏–Ω–∞</b>\n\n"
            "–í—ã –ø—Ä–æ–∂–∏–ª–∏ —Å—É–¥—å–±–æ–Ω–æ—Å–Ω—ã–µ –≥–æ–¥—ã –≤–æ –≥–ª–∞–≤–µ –°–æ–≤–µ—Ç—Å–∫–æ–≥–æ –°–æ—é–∑–∞. "
            "–•–æ–ª–æ–¥–Ω–∞—è –≤–æ–π–Ω–∞ –≤ —Å–∞–º–æ–º —Ä–∞–∑–≥–∞—Ä–µ. –í–∞—à–∏ —Ä–µ—à–µ–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª–∏–ª–∏ –µ–≥–æ –ª–∏—Ü–æ.\n\n"
            "<b>–ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø–æ–º–Ω–∏—Ç –≤–∞—Å —Ç–∞–∫–∏–º, –∫–∞–∫–∏–º –≤—ã –±—ã–ª–∏.</b>"
        ),
        "is_final": True
    }

}

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"""
    context.user_data['year'] = 1945
    context.user_data['stats'] = {'reputation': 0, 'health': 100}
    chapter = game_data[1]

    await update.message.reply_text(
        text=f"{chapter['title']}\n\n{chapter['description']}",
        parse_mode='HTML',
        reply_markup=main_menu_keyboard()
    )


def main_menu_keyboard():
    """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é"""
    keyboard = [
        [InlineKeyboardButton("‚û°Ô∏è –ù–∞—á–∞—Ç—å –∏–≥—Ä—É", callback_data='new_game')],
        [InlineKeyboardButton("üìú –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∞—è —Å–ø—Ä–∞–≤–∫–∞", callback_data='show_history')]
    ]
    return InlineKeyboardMarkup(keyboard)


# –ß–µ—Ä—á–∏–ª—å
async def handle_churchill_choice(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä –≤ —Å—Ü–µ–Ω–µ –ß–µ—Ä—á–∏–ª–ª—è –∏ –≤–µ–¥–µ—Ç –∫ –ü–æ—Ç—Å–¥–∞–º—É"""
    query = update.callback_query
    await query.answer()

    choice_idx = int(query.data.split('_')[-1])
    chapter = game_data[2]
    choice = chapter['choices'][choice_idx]

    for stat, value in choice['effects'].items():
        context.user_data['stats'][stat] = context.user_data['stats'].get(stat, 0) + value

    await show_potsdam_conference(update, context)
    # –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
    context.user_data['year'] += 1

    if choice.get('is_final', False):
        await show_final_screen(update, context, outcome_key="global_war")
        return

async def show_churchill_history(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    text = (
        "<b>–§—É–ª—Ç–æ–Ω—Å–∫–∞—è —Ä–µ—á—å –ß–µ—Ä—á–∏–ª–ª—è (1946)</b>\n\n"
        "–í –º–∞—Ä—Ç–µ 1946 –≥–æ–¥–∞ –≤ –Ω–µ–±–æ–ª—å—à–æ–º –≥–æ—Ä–æ–¥–∫–µ –§—É–ª—Ç–æ–Ω (—à—Ç–∞—Ç –ú–∏—Å—Å—É—Ä–∏, –°–®–ê) "
        "–£–∏–Ω—Å—Ç–æ–Ω –ß–µ—Ä—á–∏–ª–ª—å –ø—Ä–æ–∏–∑–Ω—ë—Å –∑–Ω–∞–º–µ–Ω–∏—Ç—É—é —Ä–µ—á—å, –≤ –∫–æ—Ç–æ—Ä–æ–π –ø—Ä–µ–¥—É–ø—Ä–µ–¥–∏–ª –æ–± —É–≥—Ä–æ–∑–µ, "
        "–∏—Å—Ö–æ–¥—è—â–µ–π –æ—Ç –°–æ–≤–µ—Ç—Å–∫–æ–≥–æ –°–æ—é–∑–∞, –∏ —É–ø–æ–º—è–Ω—É–ª –æ '–∂–µ–ª–µ–∑–Ω–æ–º –∑–∞–Ω–∞–≤–µ—Å–µ', "
        "—Ä–∞–∑–¥–µ–ª—è—é—â–µ–º –í–æ—Å—Ç–æ—á–Ω—É—é –∏ –ó–∞–ø–∞–¥–Ω—É—é –ï–≤—Ä–æ–ø—É. –≠—Ç–∞ —Ä–µ—á—å —Å—Ç–∞–ª–∞ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∏–º –Ω–∞—á–∞–ª–æ–º –•–æ–ª–æ–¥–Ω–æ–π –≤–æ–π–Ω—ã."
    )

    await update.callback_query.edit_message_text(
        text=text,
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup([
            [InlineKeyboardButton("‚Ü©Ô∏è –ù–∞–∑–∞–¥ –∫ —Å–ø—Ä–∞–≤–∫–µ", callback_data='show_history')],
            [InlineKeyboardButton("‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
        ])
    )

async def show_churchill_scene(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ü–µ–Ω—É —Å –ß–µ—Ä—á–∏–ª–ª–µ–º"""
    chapter = game_data[2]
    keyboard = [
        [InlineKeyboardButton(choice["text"], callback_data=choice["callback"])]
        for choice in chapter['choices']
    ]
    keyboard.append([InlineKeyboardButton("–ù–∞–∑–∞–¥", callback_data='back_to_main')])

    if update.callback_query:
        await update.callback_query.edit_message_text(
            text=f"<b>{chapter['title']}</b>\n\n{chapter['description']}",
            parse_mode='HTML',
            reply_markup=InlineKeyboardMarkup(keyboard)
        )
    else:
        await update.message.reply_text(
            text=f"<b>{chapter['title']}</b>\n\n{chapter['description']}",
            parse_mode='HTML',
            reply_markup=InlineKeyboardMarkup(keyboard)
        )

# –ö–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—è
async def show_potsdam_conference(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π –ü–æ—Ç—Å–¥–∞–º—Å–∫–æ–π –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏"""
    chapter = game_data[3]
    await update.callback_query.edit_message_text(
        text=f"<b>{chapter['title']}</b>\n\n{chapter['description']}",
        parse_mode='HTML',
        reply_markup=get_choices_keyboard(chapter)
    )

async def handle_potsdam_choice(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä –Ω–∞ –ü–æ—Ç—Å–¥–∞–º—Å–∫–æ–π –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏"""
    query = update.callback_query
    await query.answer()

    choice_idx = int(query.data.split('_')[1])
    chapter = game_data[3]
    choice = chapter['choices'][choice_idx]

    for stat, value in choice['effects'].items():
        context.user_data['stats'][stat] = context.user_data['stats'].get(stat, 0) + value

    context.user_data['last_choice'] = choice_idx

    if choice_idx == 1:
        await show_berlin_crisis(update, context)
    elif choice_idx == 2:
        await show_marshall_plan(update, context)
    elif choice_idx == 0:
        await show_spy_scandal(update, context)
    else:
        result_message = f"<b>–†–µ–∑—É–ª—å—Ç–∞—Ç:</b>\n{choice['result']}\n\n..."
        await query.edit_message_text(
            text=result_message,
            parse_mode='HTML',
            reply_markup=InlineKeyboardMarkup([
                [InlineKeyboardButton("‚û°Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", callback_data=choice['next_event'].lower().replace(" ", "_"))],
                [InlineKeyboardButton("‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
            ])
        )
    # –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
    context.user_data['year'] += 1

    if choice.get('is_final', False):
        await show_final_screen(update, context, outcome_key="global_war")
        return

async def show_potsdam_history(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    text = (
        "<b>–ü–æ—Ç—Å–¥–∞–º—Å–∫–∞—è –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—è (1945)</b>\n\n"
        "–õ–µ—Ç–æ–º 1945 –≥–æ–¥–∞ –ª–∏–¥–µ—Ä—ã –°–°–°–†, –°–®–ê –∏ –í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏–∏ —Å–æ–±—Ä–∞–ª–∏—Å—å –≤ –ü–æ—Ç—Å–¥–∞–º–µ, —á—Ç–æ–±—ã "
        "—Ä–µ—à–∏—Ç—å —Å—É–¥—å–±—É –ø–æ—Å–ª–µ–≤–æ–µ–Ω–Ω–æ–≥–æ –º–∏—Ä–∞. –ö–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª–∏–ª–∞ –Ω–æ–≤—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã –ì–µ—Ä–º–∞–Ω–∏–∏, "
        "–ø—Ä–æ–≥—Ä–∞–º–º—É –µ—ë –¥–µ–º–∏–ª–∏—Ç–∞—Ä–∏–∑–∞—Ü–∏–∏ –∏ —Ä–µ–ø–∞—Ä–∞—Ü–∏–∏. –í —ç—Ç–æ –∂–µ –≤—Ä–µ–º—è –°–®–ê —Å–æ–æ–±—â–∏–ª–∏ –æ —Å–æ–∑–¥–∞–Ω–∏–∏ –∞—Ç–æ–º–Ω–æ–π –±–æ–º–±—ã, "
        "—á—Ç–æ —É—Å–∏–ª–∏–ª–æ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ –º–µ–∂–¥—É —Å–æ—é–∑–Ω–∏–∫–∞–º–∏."
    )

    await update.callback_query.edit_message_text(
        text=text,
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup([
            [InlineKeyboardButton("‚Ü©Ô∏è –ù–∞–∑–∞–¥ –∫ —Å–ø—Ä–∞–≤–∫–µ", callback_data='show_history')],
            [InlineKeyboardButton("‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
        ])
    )

# –°–∫–∞–Ω–¥–∞–ª
async def show_spy_scandal(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π —à–ø–∏–æ–Ω—Å–∫–æ–≥–æ —Å–∫–∞–Ω–¥–∞–ª–∞"""
    chapter = game_data[4]
    keyboard = [
        [InlineKeyboardButton(choice["text"], callback_data=f"spy_choice_{i}")]
        for i, choice in enumerate(chapter['choices'])
    ]
    keyboard.append([InlineKeyboardButton("‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')])

    await update.callback_query.edit_message_text(
        text=f"<b>{chapter['title']}</b>\n\n{chapter['description']}",
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup(keyboard)
    )

async def handle_spy_choice(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä –≤ —à–ø–∏–æ–Ω—Å–∫–æ–º —Å–∫–∞–Ω–¥–∞–ª–µ"""
    query = update.callback_query
    await query.answer()

    choice_idx = int(query.data.split('_')[-1])
    chapter = game_data[4]
    choice = chapter['choices'][choice_idx]

    for stat, value in choice['effects'].items():
        context.user_data['stats'][stat] = context.user_data['stats'].get(stat, 0) + value

    result_message = (
        f"<b>–†–µ–∑—É–ª—å—Ç–∞—Ç:</b>\n{choice['result']}\n\n"
        f"<b>–°–ª–µ–¥—É—é—â–µ–µ —Å–æ–±—ã—Ç–∏–µ:</b> {choice['next_event']}\n\n"
        f"<b>–¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:</b>\n"
        f"‚ò¢Ô∏è –Ø–¥–µ—Ä–Ω—ã–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è: {context.user_data['stats'].get('nuclear_research', 0)}\n"
        f"üè≠ –≠–∫–æ–Ω–æ–º–∏–∫–∞: {context.user_data['stats'].get('economy', 0)}\n"
        f"üåç –í–ª–∏—è–Ω–∏–µ –≤ –ï–≤—Ä–æ–ø–µ: {context.user_data['stats'].get('europe_influence', 0)}\n"
        f"üá∫üá∏ –û—Ç–Ω–æ—à–µ–Ω–∏—è —Å –°–®–ê: {context.user_data['stats'].get('us_relations', 0)}"
    )

    if choice_idx == 0:
        next_callback = "proceed_to_rds1"
    else:
        next_callback = choice['next_event'].lower().replace(" ", "_")

    await query.edit_message_text(
        text=result_message,
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup([
            [InlineKeyboardButton("‚û°Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", callback_data=next_callback)],
            [InlineKeyboardButton("‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
        ])
    )
    # –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
    context.user_data['year'] += 1

    if choice.get('is_final', False):
        await show_final_screen(update, context, outcome_key="global_war")
        return

async def show_spy_history(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    text = (
        "<b>–®–ø–∏–æ–Ω—Å–∫–∏–π —Å–∫–∞–Ω–¥–∞–ª (1946)</b>\n\n"
        "–ü–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –í—Ç–æ—Ä–æ–π –º–∏—Ä–æ–≤–æ–π –≤–æ–π–Ω—ã –°–®–ê –Ω–∞—á–∞–ª–∏ –∞–∫—Ç–∏–≤–Ω–æ —Å–æ–±–∏—Ä–∞—Ç—å —Ä–∞–∑–≤–µ–¥–¥–∞–Ω–Ω—ã–µ –æ "
        "—è–¥–µ—Ä–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ –°–°–°–†. –í –æ—Ç–≤–µ—Ç —Å–æ–≤–µ—Ç—Å–∫–∏–µ –æ—Ä–≥–∞–Ω—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —É—Å–∏–ª–∏–ª–∏ –∫–æ–Ω—Ç—Ä–æ–ª—å, "
        "—Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –∏ –∑–∞–ø—É—Å—Ç–∏–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–µ–∑–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏. –≠—Ç–æ—Ç —Å–∫—Ä—ã—Ç—ã–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç –ø–æ–≤–ª–∏—è–ª –Ω–∞ "
        "–≥–æ–Ω–∫—É —è–¥–µ—Ä–Ω—ã—Ö –≤–æ–æ—Ä—É–∂–µ–Ω–∏–π –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –¥–≤—É—Ö —Å–≤–µ—Ä—Ö–¥–µ—Ä–∂–∞–≤."
    )

    await update.callback_query.edit_message_text(
        text=text,
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup([
            [InlineKeyboardButton("‚Ü©Ô∏è –ù–∞–∑–∞–¥ –∫ —Å–ø—Ä–∞–≤–∫–µ", callback_data='show_history')],
            [InlineKeyboardButton("‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
        ])
    )

# –ë–µ—Ä–ª–∏–Ω
async def show_berlin_crisis(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π –ë–µ—Ä–ª–∏–Ω—Å–∫–æ–≥–æ –∫—Ä–∏–∑–∏—Å–∞"""
    chapter = game_data[5]
    keyboard = []

    for i, choice in enumerate(chapter['choices']):
        if 'check' in choice:
            if choice['check'](context.user_data['stats']):
                keyboard.append([InlineKeyboardButton(choice["text"], callback_data=f"berlin_choice_{i}")])
        else:
            keyboard.append([InlineKeyboardButton(choice["text"], callback_data=f"berlin_choice_{i}")])

    keyboard.append([InlineKeyboardButton("‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')])

    await update.callback_query.edit_message_text(
        text=f"<b>{chapter['title']}</b>\n\n{chapter['description']}",
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup(keyboard)
    )

async def show_berlin_history(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    text = (
        "<b>–ë–µ—Ä–ª–∏–Ω—Å–∫–∏–π –∫—Ä–∏–∑–∏—Å (1948)</b>\n\n"
        "–í 1948 –≥–æ–¥—É –°–°–°–† –Ω–∞—á–∞–ª –±–ª–æ–∫–∞–¥—É –ó–∞–ø–∞–¥–Ω–æ–≥–æ –ë–µ—Ä–ª–∏–Ω–∞, –ø—ã—Ç–∞—è—Å—å –≤—ã–Ω—É–¥–∏—Ç—å –∑–∞–ø–∞–¥–Ω—ã–µ –¥–µ—Ä–∂–∞–≤—ã –æ—Ç–∫–∞–∑–∞—Ç—å—Å—è "
        "–æ—Ç —Å–≤–æ–∏—Ö –ø–ª–∞–Ω–æ–≤ –ø–æ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—é –∑–∞–ø–∞–¥–Ω—ã—Ö –∑–æ–Ω –ì–µ—Ä–º–∞–Ω–∏–∏. –í –æ—Ç–≤–µ—Ç –°–®–ê –∏ –∏—Ö —Å–æ—é–∑–Ω–∏–∫–∏ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–ª–∏ "
        "–≤–æ–∑–¥—É—à–Ω—ã–π –º–æ—Å—Ç, —Å–Ω–∞–±–∂–∞—è –≥–æ—Ä–æ–¥ –ø—Ä–æ–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ–º –∏ —Ç–æ–ø–ª–∏–≤–æ–º. –ë–ª–æ–∫–∞–¥–∞ –ø—Ä–æ–≤–∞–ª–∏–ª–∞—Å—å, –∏ –∫—Ä–∏–∑–∏—Å —Å—Ç–∞–ª "
        "–æ–¥–Ω–∏–º –∏–∑ –ø–µ—Ä–≤—ã—Ö –æ—Å—Ç—Ä—ã—Ö –º–æ–º–µ–Ω—Ç–æ–≤ –•–æ–ª–æ–¥–Ω–æ–π –≤–æ–π–Ω—ã."
    )

    await update.callback_query.edit_message_text(
        text=text,
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup([
            [InlineKeyboardButton("‚Ü©Ô∏è –ù–∞–∑–∞–¥ –∫ —Å–ø—Ä–∞–≤–∫–µ", callback_data='show_history')],
            [InlineKeyboardButton("‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
        ])
    )

async def handle_berlin_choice(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä –≤ –ë–µ—Ä–ª–∏–Ω—Å–∫–æ–º –∫—Ä–∏–∑–∏—Å–µ"""
    query = update.callback_query
    await query.answer()

    choice_idx = int(query.data.split('_')[-1])
    chapter = game_data[5]
    choice = chapter['choices'][choice_idx]

    for stat, value in choice['effects'].items():
        context.user_data['stats'][stat] = context.user_data['stats'].get(stat, 0) + value

    context.user_data['last_choice'] = choice_idx

    if choice_idx == 1:
        await show_cuban_crisis(update, context)
    else:
        result_text = choice['result'].format('–ó–∞–ø–∞–¥ –æ—Ç–≤–µ—á–∞–µ—Ç –≤–æ–∑–¥—É—à–Ω—ã–º –º–æ—Å—Ç–æ–º.')

        result_message = (
            f"<b>–†–µ–∑—É–ª—å—Ç–∞—Ç:</b>\n{result_text}\n\n"
            f"<b>–°–ª–µ–¥—É—é—â–µ–µ —Å–æ–±—ã—Ç–∏–µ:</b> {choice['next_event']}\n\n"
            f"<b>–¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:</b>\n"
            f"‚öîÔ∏è –í–æ–µ–Ω–Ω–∞—è –º–æ—â—å: {context.user_data['stats'].get('military', 0)}\n"
            f"üè≠ –≠–∫–æ–Ω–æ–º–∏–∫–∞: {context.user_data['stats'].get('economy', 0)}\n"
            f"‚ò¢Ô∏è –Ø–¥–µ—Ä–Ω—ã–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è: {context.user_data['stats'].get('nuclear_research', 0)}\n"
            f"üåç –í–ª–∏—è–Ω–∏–µ –≤ –ï–≤—Ä–æ–ø–µ: {context.user_data['stats'].get('europe_influence', 0)}\n"
            f"üá∫üá∏ –û—Ç–Ω–æ—à–µ–Ω–∏—è —Å –°–®–ê: {context.user_data['stats'].get('us_relations', 0)}"
        )

        await query.edit_message_text(
            text=result_message,
            parse_mode='HTML',
            reply_markup=InlineKeyboardMarkup([
                [InlineKeyboardButton("‚û°Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", callback_data=choice['next_event'].lower().replace(" ", "_"))],
                [InlineKeyboardButton("‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
            ])
        )
    # –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
    context.user_data['year'] += 1

    if choice.get('is_final', False):
        await show_final_screen(update, context, outcome_key="global_war")
        return


# –ú–∞—Ä—à–∞–ª
async def show_marshall_plan(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π –ü–ª–∞–Ω–∞ –ú–∞—Ä—à–∞–ª–ª–∞"""
    chapter = game_data[6]
    keyboard = [
        [InlineKeyboardButton(choice["text"], callback_data=f"marshall_choice_{i}")]
        for i, choice in enumerate(chapter['choices'])
    ]
    keyboard.append([InlineKeyboardButton("‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')])

    await update.callback_query.edit_message_text(
        text=f"<b>{chapter['title']}</b>\n\n{chapter['description']}",
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup(keyboard)
    )

async def handle_marshall_choice(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä –≤ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ü–ª–∞–Ω–∞ –ú–∞—Ä—à–∞–ª–ª–∞"""
    query = update.callback_query
    await query.answer()

    choice_idx = int(query.data.split('_')[-1])
    chapter = game_data[6]
    choice = chapter['choices'][choice_idx]

    for stat, value in choice['effects'].items():
        context.user_data['stats'][stat] = context.user_data['stats'].get(stat, 0) + value

    result_message = (
        f"<b>–†–µ–∑—É–ª—å—Ç–∞—Ç:</b>\n{choice['result']}\n\n"
        f"<b>–°–ª–µ–¥—É—é—â–µ–µ —Å–æ–±—ã—Ç–∏–µ:</b> {choice['next_event']}\n\n"
        f"<b>–¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:</b>\n"
        f"üè≠ –≠–∫–æ–Ω–æ–º–∏–∫–∞: {context.user_data['stats'].get('economy', 0)}\n"
        f"üåç –í–ª–∏—è–Ω–∏–µ –≤ –ï–≤—Ä–æ–ø–µ: {context.user_data['stats'].get('europe_influence', 0)}\n"
        f"üá∫üá∏ –û—Ç–Ω–æ—à–µ–Ω–∏—è —Å –°–®–ê: {context.user_data['stats'].get('us_relations', 0)}"
    )

    await query.edit_message_text(
        text=result_message,
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup([
            [InlineKeyboardButton("‚û°Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", callback_data=choice['next_event'].lower().replace(" ", "_"))],
            [InlineKeyboardButton("‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
        ])
    )
    # –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
    context.user_data['year'] += 1

    if choice.get('is_final', False):
        await show_final_screen(update, context, outcome_key="global_war")
        return


# –ö—Ä–∏–∑–∏—Å
async def show_cuban_crisis(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π –ö–∞—Ä–∏–±—Å–∫–æ–≥–æ –∫—Ä–∏–∑–∏—Å–∞"""
    chapter = game_data[7]
    keyboard = []

    for i, choice in enumerate(chapter['choices']):
        if 'check' in choice:
            if choice['check'](context.user_data['stats']):
                keyboard.append([InlineKeyboardButton(choice["text"], callback_data=f"cuban_choice_{i}")])
        else:
            keyboard.append([InlineKeyboardButton(choice["text"], callback_data=f"cuban_choice_{i}")])

    keyboard.append([InlineKeyboardButton("‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')])

    await update.callback_query.edit_message_text(
        text=f"<b>{chapter['title']}</b>\n\n{chapter['description']}",
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup(keyboard)
    )

async def handle_cuban_choice(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä –≤ –ö–∞—Ä–∏–±—Å–∫–æ–º –∫—Ä–∏–∑–∏—Å–µ"""
    query = update.callback_query
    await query.answer()

    choice_idx = int(query.data.split('_')[-1])
    chapter = game_data[7]
    choice = chapter['choices'][choice_idx]

    for stat, value in choice['effects'].items():
        context.user_data['stats'][stat] = context.user_data['stats'].get(stat, 0) + value

    result_message = f"<b>–†–µ–∑—É–ª—å—Ç–∞—Ç:</b>\n{choice['result']}\n\n"

    if choice.get('is_final', False):
        result_message += "<b>–ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</b>"
        keyboard = [
            [InlineKeyboardButton("üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ", callback_data='new_game')],
            [InlineKeyboardButton("‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
        ]
    else:
        result_message += (
            f"<b>–°–ª–µ–¥—É—é—â–µ–µ —Å–æ–±—ã—Ç–∏–µ:</b> {choice['next_event']}\n\n"
            f"<b>–¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:</b>\n"
            f"‚öîÔ∏è –í–æ–µ–Ω–Ω–∞—è –º–æ—â—å: {context.user_data['stats'].get('military', 0)}\n"
            f"üá∫üá∏ –û—Ç–Ω–æ—à–µ–Ω–∏—è —Å –°–®–ê: {context.user_data['stats'].get('us_relations', 0)}"
        )
        keyboard = [
            [InlineKeyboardButton("‚û°Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", callback_data=choice['next_event'].lower().replace(" ", "_"))],
            [InlineKeyboardButton("‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
        ]

    await query.edit_message_text(
        text=result_message,
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup(keyboard)
    )
    # –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
    context.user_data['year'] += 1

    if choice.get('is_final', False):
        await show_final_screen(update, context, outcome_key="global_war")
        return

async def show_cuban_history(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    text = (
        "<b>–ö–∞—Ä–∏–±—Å–∫–∏–π –∫—Ä–∏–∑–∏—Å (1962)</b>\n\n"
        "–ö–∞—Ä–∏–±—Å–∫–∏–π –∫—Ä–∏–∑–∏—Å (–æ–∫—Ç—è–±—Ä—å 1962) - 13-–¥–Ω–µ–≤–Ω–æ–µ –ø—Ä–æ—Ç–∏–≤–æ—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –°–°–°–† –∏ –°–®–ê, "
        "–∫–æ–≥–¥–∞ –º–∏—Ä –æ–∫–∞–∑–∞–ª—Å—è –Ω–∞ –≥—Ä–∞–Ω–∏ —è–¥–µ—Ä–Ω–æ–π –≤–æ–π–Ω—ã. –°–°–°–† —Ä–∞–∑–º–µ—Å—Ç–∏–ª —è–¥–µ—Ä–Ω—ã–µ —Ä–∞–∫–µ—Ç—ã –Ω–∞ –ö—É–±–µ "
        "–≤ –æ—Ç–≤–µ—Ç –Ω–∞ –∞–º–µ—Ä–∏–∫–∞–Ω—Å–∫–∏–µ —Ä–∞–∫–µ—Ç—ã –≤ –¢—É—Ä—Ü–∏–∏. –ö—Ä–∏–∑–∏—Å –Ω–∞—á–∞–ª—Å—è 14 –æ–∫—Ç—è–±—Ä—è, –∫–æ–≥–¥–∞ –°–®–ê "
        "–æ–±–Ω–∞—Ä—É–∂–∏–ª–∏ —Å–æ–≤–µ—Ç—Å–∫–∏–µ —Ä–∞–∫–µ—Ç—ã –Ω–∞ –ö—É–±–µ, –∏ –¥–æ—Å—Ç–∏–≥ –ø–∏–∫—Ç–∞ 27 –æ–∫—Ç—è–±—Ä—è, –∫–æ–≥–¥–∞ —Å–æ–≤–µ—Ç—Å–∫–∏–µ "
        "—Å–∏–ª—ã —Å–±–∏–ª–∏ –∞–º–µ—Ä–∏–∫–∞–Ω—Å–∫–∏–π —Å–∞–º–æ–ª–µ—Ç-—Ä–∞–∑–≤–µ–¥—á–∏–∫ U-2.\n\n"
        "–ö—Ä–∏–∑–∏—Å –±—ã–ª —Ä–∞–∑—Ä–µ—à–µ–Ω, –∫–æ–≥–¥–∞ –°–°–°–† —Å–æ–≥–ª–∞—Å–∏–ª—Å—è —É–±—Ä–∞—Ç—å —Ä–∞–∫–µ—Ç—ã —Å –ö—É–±—ã –≤ –æ–±–º–µ–Ω –Ω–∞ "
        "—Ç–∞–π–Ω–æ–µ –æ–±–µ—â–∞–Ω–∏–µ –°–®–ê —É–±—Ä–∞—Ç—å —Ä–∞–∫–µ—Ç—ã –∏–∑ –¢—É—Ä—Ü–∏–∏ –∏ –≥–∞—Ä–∞–Ω—Ç–∏–∏ –Ω–µ–Ω–∞–ø–∞–¥–µ–Ω–∏—è –Ω–∞ –ö—É–±—É. "
        "–≠—Ç–æ—Ç –∫—Ä–∏–∑–∏—Å –ø—Ä–∏–≤–µ–ª –∫ —Å–æ–∑–¥–∞–Ω–∏—é –≥–æ—Ä—è—á–µ–π –ª–∏–Ω–∏–∏ –º–µ–∂–¥—É –ú–æ—Å–∫–≤–æ–π –∏ –í–∞—à–∏–Ω–≥—Ç–æ–Ω–æ–º –∏ "
        "–Ω–∞—á–∞–ª—É –ø–æ–ª–∏—Ç–∏–∫–∏ —Ä–∞–∑—Ä—è–¥–∫–∏ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–π –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω–æ—Å—Ç–∏."
    )

    await update.callback_query.edit_message_text(
        text=text,
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup([
            [InlineKeyboardButton("‚Ü©Ô∏è –ù–∞–∑–∞–¥ –∫ —Å–ø—Ä–∞–≤–∫–µ", callback_data='show_history')],
            [InlineKeyboardButton("‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
        ])
    )

# –ò—Å–ø—ã—Ç–∞–Ω–∏–µ
async def show_rds1_test(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π –∏—Å–ø—ã—Ç–∞–Ω–∏—è –†–î–°-1"""
    chapter = game_data[8]
    keyboard = [
        [InlineKeyboardButton(choice["text"], callback_data=f"rds1_choice_{i}")]
        for i, choice in enumerate(chapter['choices'])
    ]
    keyboard.append([InlineKeyboardButton("‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')])

    await update.callback_query.edit_message_text(
        text=f"<b>{chapter['title']}</b>\n\n{chapter['description']}",
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup(keyboard)
    )

async def handle_rds1_choice(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä –≤ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø—ã—Ç–∞–Ω–∏—è –†–î–°-1"""
    query = update.callback_query
    await query.answer()

    choice_idx = int(query.data.split('_')[-1])
    chapter = game_data[8]
    choice = chapter['choices'][choice_idx]

    # –ü—Ä–∏–º–µ–Ω—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã
    for stat, value in choice['effects'].items():
        context.user_data['stats'][stat] = context.user_data['stats'].get(stat, 0) + value

    # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
    result_message = (
        f"<b>–†–µ–∑—É–ª—å—Ç–∞—Ç:</b>\n{choice['result']}\n\n"
        f"<b>–°–ª–µ–¥—É—é—â–µ–µ —Å–æ–±—ã—Ç–∏–µ:</b> {choice['next_event']}\n\n"
        f"<b>–¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:</b>\n"
        f"‚öîÔ∏è –í–æ–µ–Ω–Ω–∞—è –º–æ—â—å: {context.user_data['stats'].get('military', 0)}\n"
        f"‚ò¢Ô∏è –Ø–¥–µ—Ä–Ω—ã–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è: {context.user_data['stats'].get('nuclear_research', 0)}\n"
        f"üåç –í–ª–∏—è–Ω–∏–µ –≤ –ï–≤—Ä–æ–ø–µ: {context.user_data['stats'].get('europe_influence', 0)}\n"
        f"üá∫üá∏ –û—Ç–Ω–æ—à–µ–Ω–∏—è —Å –°–®–ê: {context.user_data['stats'].get('us_relations', 0)}"
    )

    await query.edit_message_text(
        text=result_message,
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup([
            [InlineKeyboardButton("‚û°Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", callback_data=choice['next_event'].lower().replace(" ", "_"))],
            [InlineKeyboardButton("‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
        ])
    )
    # –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
    context.user_data['year'] += 1

    if choice.get('is_final', False):
        await show_final_screen(update, context, outcome_key="global_war")
        return

async def show_rds1_history(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    text = (
        "<b>–ò—Å–ø—ã—Ç–∞–Ω–∏–µ –†–î–°-1 (1949)</b>\n\n"
        "29 –∞–≤–≥—É—Å—Ç–∞ 1949 –≥–æ–¥–∞ –Ω–∞ –°–µ–º–∏–ø–∞–ª–∞—Ç–∏–Ω—Å–∫–æ–º –ø–æ–ª–∏–≥–æ–Ω–µ –°–°–°–† –ø—Ä–æ–≤–µ–ª —É—Å–ø–µ—à–Ω—ã–µ –∏—Å–ø—ã—Ç–∞–Ω–∏—è "
        "–ø–µ—Ä–≤–æ–π –∞—Ç–æ–º–Ω–æ–π –±–æ–º–±—ã –†–î–°-1 ('–†–µ–∞–∫—Ç–∏–≤–Ω—ã–π –¥–≤–∏–≥–∞—Ç–µ–ª—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π').\n\n"
        "–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–∫—Ç—ã:\n"
        "‚Ä¢ –ú–æ—â–Ω–æ—Å—Ç—å –≤–∑—Ä—ã–≤–∞: 22 –∫–∏–ª–æ—Ç–æ–Ω–Ω—ã\n"
        "‚Ä¢ –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–ª–∞—Å—å –≤ —Ä–∞–º–∫–∞—Ö –∞—Ç–æ–º–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ–¥ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ–º –ö—É—Ä—á–∞—Ç–æ–≤–∞\n"
        "‚Ä¢ –ò—Å–ø—ã—Ç–∞–Ω–∏–µ –ø—Ä–æ–≤–æ–¥–∏–ª–æ—Å—å –≤ —É—Å–ª–æ–≤–∏—è—Ö —Å—Ç—Ä–æ–∂–∞–π—à–µ–π —Å–µ–∫—Ä–µ—Ç–Ω–æ—Å—Ç–∏\n"
        "‚Ä¢ –°–®–ê –æ–±–Ω–∞—Ä—É–∂–∏–ª–∏ —Ñ–∞–∫—Ç –∏—Å–ø—ã—Ç–∞–Ω–∏—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ 2 –Ω–µ–¥–µ–ª–∏ –ø–æ –∞–Ω–∞–ª–∏–∑–∞–º –≤–æ–∑–¥—É—Ö–∞\n\n"
        "–≠—Ç–æ —Å–æ–±—ã—Ç–∏–µ –ø–æ–ª–æ–∂–∏–ª–æ –∫–æ–Ω–µ—Ü –∞–º–µ—Ä–∏–∫–∞–Ω—Å–∫–æ–π –º–æ–Ω–æ–ø–æ–ª–∏–∏ –Ω–∞ —è–¥–µ—Ä–Ω–æ–µ –æ—Ä—É–∂–∏–µ –∏ "
        "–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –∏–∑–º–µ–Ω–∏–ª–æ –±–∞–ª–∞–Ω—Å —Å–∏–ª –≤ –•–æ–ª–æ–¥–Ω–æ–π –≤–æ–π–Ω–µ."
    )

    await update.callback_query.edit_message_text(
        text=text,
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup([
            [InlineKeyboardButton("‚Ü©Ô∏è –ù–∞–∑–∞–¥ –∫ —Å–ø—Ä–∞–≤–∫–µ", callback_data='show_history')],
            [InlineKeyboardButton("‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
        ])
    )

#–í–µ–Ω–æ–Ω–∞
async def show_venona_operation(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–°—Ü–µ–Ω–∞—Ä–∏–π –û–ø–µ—Ä–∞—Ü–∏–∏ '–í–µ–Ω–æ–Ω–∞'"""
    chapter = game_data[9]
    keyboard = [
        [InlineKeyboardButton(choice["text"], callback_data=f"venona_choice_{i}")]
        for i, choice in enumerate(chapter['choices'])
    ]
    keyboard.append([InlineKeyboardButton("‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')])

    await update.callback_query.edit_message_text(
        text=f"<b>{chapter['title']}</b>\n\n{chapter['description']}",
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup(keyboard)
    )

async def handle_venona_choice(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    query = update.callback_query
    await query.answer()

    choice_idx = int(query.data.split('_')[-1])
    chapter = game_data[9]
    choice = chapter['choices'][choice_idx]

    apply_effects(context, choice['effects'])
    context.user_data['year'] += 1

    result_message = (
        f"<b>–†–µ–∑—É–ª—å—Ç–∞—Ç:</b>\n{choice['result']}\n\n"
        f"<b>–°–ª–µ–¥—É—é—â–µ–µ —Å–æ–±—ã—Ç–∏–µ:</b> {choice['next_event']}\n\n"
        f"<b>–¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:</b>\n{get_stats_display(context)}"
    )

    await query.edit_message_text(
        text=result_message,
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup([
            [InlineKeyboardButton("‚û°Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", callback_data=choice['next_event'].lower().replace(" ", "_"))],
            [InlineKeyboardButton("‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
        ])
    )

async def show_venona_history(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    text = (
        "<b>–û–ø–µ—Ä–∞—Ü–∏—è '–í–µ–Ω–æ–Ω–∞' (1948‚Äì1950)</b>\n\n"
        "¬´–í–µ–Ω–æ–Ω–∞¬ª ‚Äî —Å–µ–∫—Ä–µ—Ç–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –∞–º–µ—Ä–∏–∫–∞–Ω—Å–∫–∏—Ö —Å–ø–µ—Ü—Å–ª—É–∂–± –ø–æ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–µ —Å–æ–≤–µ—Ç—Å–∫–∏—Ö —à–∏—Ñ—Ä–æ–≤–æ–∫, "
        "–ø–µ—Ä–µ–¥–∞–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–∞–º–∏ –ù–ö–í–î –∏ –ì–†–£ –≤ –°–®–ê –∏ –¥—Ä—É–≥–∏—Ö —Å—Ç—Ä–∞–Ω–∞—Ö.\n\n"
        "–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –±—ã–ª–∏ —Ä–∞—Å–∫—Ä—ã—Ç—ã –ª–∏—á–Ω–æ—Å—Ç–∏ –¥–µ—Å—è—Ç–∫–æ–≤ —Å–æ–≤–µ—Ç—Å–∫–∏—Ö –∞–≥–µ–Ω—Ç–æ–≤, –≤–∫–ª—é—á–∞—è —É—á—ë–Ω—ã—Ö, –¥–∏–ø–ª–æ–º–∞—Ç–æ–≤ –∏ –∂—É—Ä–Ω–∞–ª–∏—Å—Ç–æ–≤. "
        "–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ –≤–Ω–µ—Å–ª–∏ –≤–∫–ª–∞–¥ –≤ –¥–µ–ª–æ –†–æ–∑–µ–Ω–±–µ—Ä–≥–æ–≤ –∏ –æ–±–æ—Å—Ç—Ä–∏–ª–∏ —à–ø–∏–æ–Ω—Å–∫—É—é –ø–∞—Ä–∞–Ω–æ–π—é –≤ –°–®–ê.\n\n"
        "–°–°–°–† –≤ –æ—Ç–≤–µ—Ç –∞–∫—Ç–∏–≤–∏–∑–∏—Ä–æ–≤–∞–ª –º–µ—Ä—ã –ø–æ –∫–æ–Ω—Ç—Ä—à–ø–∏–æ–Ω–∞–∂—É –∏ —Å–º–µ–Ω–∏–ª –∫—Ä–∏–ø—Ç–æ—Å–∏—Å—Ç–µ–º—ã. "
        "–°–∞–º–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –æ—Å—Ç–∞–≤–∞–ª–∞—Å—å –∑–∞—Å–µ–∫—Ä–µ—á–µ–Ω–Ω–æ–π –≤–ø–ª–æ—Ç—å –¥–æ 1995 –≥–æ–¥–∞."
    )

    await update.callback_query.edit_message_text(
        text=text,
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup([
            [InlineKeyboardButton("‚Ü©Ô∏è –ù–∞–∑–∞–¥ –∫ —Å–ø—Ä–∞–≤–∫–µ", callback_data='show_history')],
            [InlineKeyboardButton("‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
        ])
    )

#–ù–ê–¢–û
async def show_nato_creation(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π —Å–æ–∑–¥–∞–Ω–∏—è –ù–ê–¢–û"""
    chapter = game_data[10]
    keyboard = [
        [InlineKeyboardButton(choice["text"], callback_data=f"nato_choice_{i}")]
        for i, choice in enumerate(chapter['choices'])
    ]
    keyboard.append([InlineKeyboardButton("‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')])

    await update.callback_query.edit_message_text(
        text=f"<b>{chapter['title']}</b>\n\n{chapter['description']}",
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup(keyboard)
    )

async def handle_nato_choice(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    query = update.callback_query
    await query.answer()

    choice_idx = int(query.data.split('_')[-1])
    chapter = game_data[10]
    choice = chapter['choices'][choice_idx]

    apply_effects(context, choice['effects'])
    context.user_data['year'] += 1

    result_message = (
        f"<b>–†–µ–∑—É–ª—å—Ç–∞—Ç:</b>\n{choice['result']}\n\n"
        f"<b>–°–ª–µ–¥—É—é—â–µ–µ —Å–æ–±—ã—Ç–∏–µ:</b> {choice['next_event']}\n\n"
        f"<b>–¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:</b>\n{get_stats_display(context)}"
    )

    await query.edit_message_text(
        text=result_message,
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup([
            [InlineKeyboardButton("‚û°Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", callback_data=choice['next_event'].lower().replace(" ", "_"))],
            [InlineKeyboardButton("‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
        ])
    )

#–¢–∏—Ç–æ

async def show_tito_split(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π —Ä–∞—Å–∫–æ–ª–∞ —Å –¢–∏—Ç–æ"""
    chapter = game_data[11]
    keyboard = [
        [InlineKeyboardButton(choice["text"], callback_data=f"tito_choice_{i}")]
        for i, choice in enumerate(chapter['choices'])
    ]
    keyboard.append([InlineKeyboardButton("‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')])

    await update.callback_query.edit_message_text(
        text=f"<b>{chapter['title']}</b>\n\n{chapter['description']}",
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup(keyboard)
    )

async def handle_tito_choice(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    query = update.callback_query
    await query.answer()

    choice_idx = int(query.data.split('_')[-1])
    chapter = game_data[11]
    choice = chapter['choices'][choice_idx]

    apply_effects(context, choice['effects'])
    context.user_data['year'] += 1

    if choice.get("is_final", False):
        await show_final_screen(update, context, outcome_key=choice.get("outcome_key", "end"))
        return

        # ‚úÖ –ï—Å–ª–∏ –Ω–µ —Ñ–∏–Ω–∞–ª ‚Äî –æ–±—ã—á–Ω—ã–π –≤—ã–≤–æ–¥ —Å next_event
    await query.edit_message_text(
        text=(
            f"<b>–†–µ–∑—É–ª—å—Ç–∞—Ç:</b>\n{choice['result']}\n\n"
            f"<b>–°–ª–µ–¥—É—é—â–µ–µ —Å–æ–±—ã—Ç–∏–µ:</b> {choice['next_event']}\n\n"
            f"<b>–¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:</b>\n{get_stats_display(context)}"
        ),
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup([
            [InlineKeyboardButton("‚û°Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", callback_data=choice['next_event'].lower().replace(" ", "_"))],
            [InlineKeyboardButton("‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
        ])
    )

async def show_tito_history(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    text = (
        "<b>–†–∞—Å–∫–æ–ª —Å –¢–∏—Ç–æ (1948)</b>\n\n"
        "–í 1948 –≥–æ–¥—É –ø—Ä–æ–∏–∑–æ—à—ë–ª —Å–µ—Ä—å—ë–∑–Ω—ã–π —Ä–∞–∑—Ä—ã–≤ –º–µ–∂–¥—É –°–°–°–† –∏ –Æ–≥–æ—Å–ª–∞–≤–∏–µ–π. "
        "–ò–æ—Å–∏—Ñ –ë—Ä–æ–∑ –¢–∏—Ç–æ –æ—Ç–∫–∞–∑–∞–ª—Å—è –ø–æ–¥—á–∏–Ω—è—Ç—å—Å—è —É–∫–∞–∑–∞–Ω–∏—è–º –ú–æ—Å–∫–≤—ã –∏ —Å—Ç–∞–ª –ø—Ä–æ–≤–æ–¥–∏—Ç—å "
        "—Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—É—é –≤–Ω–µ—à–Ω—é—é –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é –ø–æ–ª–∏—Ç–∏–∫—É. –°—Ç–∞–ª–∏–Ω –æ–±–≤–∏–Ω–∏–ª –¢–∏—Ç–æ –≤ "
        "–ø—Ä–µ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–µ —Å–æ—Ü–∏–∞–ª–∏—Å—Ç–∏—á–µ—Å–∫–æ–≥–æ –ª–∞–≥–µ—Ä—è, –∏ –Æ–≥–æ—Å–ª–∞–≤–∏—è –±—ã–ª–∞ –∏—Å–∫–ª—é—á–µ–Ω–∞ –∏–∑ –ö–æ–º–∏–Ω—Ñ–æ—Ä–º–∞.\n\n"
        "–≠—Ç–æ—Ç —Ä–∞—Å–∫–æ–ª —Å—Ç–∞–ª –ø–µ—Ä–≤—ã–º –∫—Ä—É–ø–Ω—ã–º –≤—ã–∑–æ–≤–æ–º –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç—É –°–°–°–† –≤–Ω—É—Ç—Ä–∏ —Å–æ—Ü–∏–∞–ª–∏—Å—Ç–∏—á–µ—Å–∫–æ–≥–æ –±–ª–æ–∫–∞ "
        "–∏ –ø–æ–∫–∞–∑–∞–ª –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö –ø—É—Ç–µ–π —Å–æ—Ü–∏–∞–ª–∏–∑–º–∞ –≤–Ω–µ –∫–æ–Ω—Ç—Ä–æ–ª—è –ú–æ—Å–∫–≤—ã."
    )

    await update.callback_query.edit_message_text(
        text=text,
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup([
            [InlineKeyboardButton("‚Ü©Ô∏è –ù–∞–∑–∞–¥ –∫ —Å–ø—Ä–∞–≤–∫–µ", callback_data='show_history')],
            [InlineKeyboardButton("‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
        ])
    )


#–î–æ–≥–æ–≤–æ—Ä

async def show_test_ban_treaty(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    chapter = game_data[12]
    keyboard = [
        [InlineKeyboardButton(choice["text"], callback_data=f"testban_choice_{i}")]
        for i, choice in enumerate(chapter['choices'])
    ]
    keyboard.append([InlineKeyboardButton("‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')])

    await update.callback_query.edit_message_text(
        text=f"<b>{chapter['title']}</b>\n\n{chapter['description']}",
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup(keyboard)
    )

async def handle_testban_choice(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    query = update.callback_query
    await query.answer()

    choice_idx = int(query.data.split('_')[-1])
    chapter = game_data[12]
    choice = chapter['choices'][choice_idx]

    apply_effects(context, choice['effects'])
    context.user_data['year'] += 1

    # ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–≥—Ä—ã –ø—Ä–∏ —Ñ–∏–Ω–∞–ª–µ
    if choice.get('is_final', False):
        await show_final_screen(update, context, outcome_key="stalemate")
        return

    # –ï—Å–ª–∏ –Ω–µ —Ñ–∏–Ω–∞–ª ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –∫–Ω–æ–ø–∫—É "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å"
    result_message = (
        f"<b>–†–µ–∑—É–ª—å—Ç–∞—Ç:</b>\n{choice['result']}\n\n"
        f"<b>–°–ª–µ–¥—É—é—â–µ–µ —Å–æ–±—ã—Ç–∏–µ:</b> {choice['next_event']}\n\n"
        f"<b>–¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:</b>\n{get_stats_display(context)}"
    )

    await query.edit_message_text(
        text=result_message,
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup([
            [InlineKeyboardButton("‚û°Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", callback_data=choice['next_event'].lower().replace(" ", "_"))],
            [InlineKeyboardButton("‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
        ])
    )

async def show_history_testban(update: Update, context: ContextTypes.DEFAULT_TYPE):
    text = (
        "<b>–î–æ–≥–æ–≤–æ—Ä –æ –∑–∞–ø—Ä–µ—Ç–µ —è–¥–µ—Ä–Ω—ã—Ö –∏—Å–ø—ã—Ç–∞–Ω–∏–π (1963)</b>\n\n"
        "–ü–æ–¥–ø–∏—Å–∞–Ω –°–°–°–†, –°–®–ê –∏ –í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏–µ–π. –ó–∞–ø—Ä–µ—Ç–∏–ª —è–¥–µ—Ä–Ω—ã–µ –∏—Å–ø—ã—Ç–∞–Ω–∏—è –≤ –∞—Ç–º–æ—Å—Ñ–µ—Ä–µ, –≤ –∫–æ—Å–º–æ—Å–µ –∏ –ø–æ–¥ –≤–æ–¥–æ–π, "
        "–Ω–æ –Ω–µ –ø–æ–¥ –∑–µ–º–ª–µ–π. –Ø–≤–∏–ª—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –ö–∞—Ä–∏–±—Å–∫–æ–≥–æ –∫—Ä–∏–∑–∏—Å–∞ –∏ —Å—Ç—Ä–µ–º–ª–µ–Ω–∏—è –∫ —Å–Ω–∏–∂–µ–Ω–∏—é –Ω–∞–ø—Ä—è–∂—ë–Ω–Ω–æ—Å—Ç–∏."
    )
    await update.callback_query.edit_message_text(text=text, parse_mode='HTML', reply_markup=back_to_history_menu())


#–°—Ç–æ–∫–≥–æ–ª—å–º—Å–∫–∞—è –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—è
async def show_stockholm_conference(update: Update, context: ContextTypes.DEFAULT_TYPE):
    chapter = game_data[13]
    keyboard = [
        [InlineKeyboardButton(choice["text"], callback_data=f"stockholm_choice_{i}")]
        for i, choice in enumerate(chapter["choices"])
    ]
    keyboard.append([InlineKeyboardButton("‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')])

    await update.callback_query.edit_message_text(
        text=f"<b>{chapter['title']}</b>\n\n{chapter['description']}",
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup(keyboard)
    )

async def handle_stockholm_choice(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()

    choice_idx = int(query.data.split('_')[-1])
    choice = game_data[13]["choices"][choice_idx]

    apply_effects(context, choice['effects'])
    context.user_data['year'] += 1

    if choice.get("is_final", False):
        outcome = choice.get("outcome_key", "global_war")
        await show_final_screen(update, context, outcome_key=outcome)
        return

    result_message = (
        f"<b>–†–µ–∑—É–ª—å—Ç–∞—Ç:</b>\n{choice['result']}\n\n"
        f"<b>–°–ª–µ–¥—É—é—â–µ–µ —Å–æ–±—ã—Ç–∏–µ:</b> {choice['next_event']}\n\n"
        f"<b>–¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:</b>\n{get_stats_display(context)}"
    )

    await query.edit_message_text(
        text=result_message + "\u200b",  # –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–∞
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup([
            [InlineKeyboardButton("‚û°Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", callback_data=choice['next_event'].lower().replace(" ", "_"))],
            [InlineKeyboardButton("‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
        ])
    )

async def show_history_stockholm(update: Update, context: ContextTypes.DEFAULT_TYPE):
    text = (
        "<b>–°—Ç–æ–∫–≥–æ–ª—å–º—Å–∫–∞—è –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—è (1951)</b>\n\n"
        "–ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–∞—è –≤—Å—Ç—Ä–µ—á–∞ —Å—Ç–æ—Ä–æ–Ω–Ω–∏–∫–æ–≤ –º–∏—Ä–∞, –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω–∞—è –ø–æ–¥ —ç–≥–∏–¥–æ–π –í—Å–µ–º–∏—Ä–Ω–æ–≥–æ —Å–æ–≤–µ—Ç–∞ –º–∏—Ä–∞. "
        "–°–°–°–† –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –µ—ë –¥–ª—è –ø—Ä–æ–ø–∞–≥–∞–Ω–¥—ã –ø—Ä–æ—Ç–∏–≤ –ù–ê–¢–û –∏ –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É —è–¥–µ—Ä–Ω–æ–≥–æ —Ä–∞–∑–æ—Ä—É–∂–µ–Ω–∏—è."
    )
    await update.callback_query.edit_message_text(text=text, parse_mode='HTML', reply_markup=back_to_history_menu())

#–í–µ–Ω–≥–µ—Ä—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–∏–µ

async def show_hungarian_uprising(update: Update, context: ContextTypes.DEFAULT_TYPE):
    chapter = game_data[14]
    keyboard = [
        [InlineKeyboardButton(choice["text"], callback_data=f"hungary_choice_{i}")]
        for i, choice in enumerate(chapter["choices"])
    ]
    keyboard.append([InlineKeyboardButton("‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')])

    await update.callback_query.edit_message_text(
        text=f"<b>{chapter['title']}</b>\n\n{chapter['description']}",
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup(keyboard)
    )

async def handle_hungary_choice(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()

    choice_idx = int(query.data.split('_')[-1])
    chapter = game_data[14]
    choice = chapter["choices"][choice_idx]

    apply_effects(context, choice["effects"])
    context.user_data["year"] += 1

    if choice.get("is_final", False) or context.user_data["year"] >= 1953:
        await show_final_screen(update, context, outcome_key="military_dominance")
        return

    result_message = (
        f"<b>–†–µ–∑—É–ª—å—Ç–∞—Ç:</b>\n{choice['result']}\n\n"
        f"<b>–°–ª–µ–¥—É—é—â–µ–µ —Å–æ–±—ã—Ç–∏–µ:</b> {choice['next_event']}\n\n"
        f"<b>–¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:</b>\n{get_stats_display(context)}"
    )

    await query.edit_message_text(
        text=result_message + "\u200b",  # –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–∞
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup([
            [InlineKeyboardButton("‚û°Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", callback_data=choice['next_event'].lower().replace(" ", "_"))],
            [InlineKeyboardButton("‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
        ])
    )

async def show_history_hungary(update: Update, context: ContextTypes.DEFAULT_TYPE):
    text = (
        "<b>–í–µ–Ω–≥–µ—Ä—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–∏–µ (1956)</b>\n\n"
        "–ê–Ω—Ç–∏—Å–æ–≤–µ—Ç—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–∏–µ –≤ –í–µ–Ω–≥—Ä–∏–∏. –ù–∞—á–∞–ª–æ—Å—å –∫–∞–∫ —Å—Ç—É–¥–µ–Ω—á–µ—Å–∫–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è, "
        "–ø—Ä–µ–≤—Ä–∞—Ç–∏–ª–æ—Å—å –≤ –≤–æ–æ—Ä—É–∂—ë–Ω–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–∏–µ. –ü–æ–¥–∞–≤–ª–µ–Ω–æ —Å–æ–≤–µ—Ç—Å–∫–∏–º–∏ –≤–æ–π—Å–∫–∞–º–∏. "
        "–í—ã–∑–≤–∞–ª–æ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—É—é –∫—Ä–∏—Ç–∏–∫—É –∏ –æ—Å–ª–∞–±–ª–µ–Ω–∏–µ –≤–ª–∏—è–Ω–∏—è –°–°–°–† –≤ –í–æ—Å—Ç–æ—á–Ω–æ–π –ï–≤—Ä–æ–ø–µ."
    )
    await update.callback_query.edit_message_text(text=text, parse_mode='HTML', reply_markup=back_to_history_menu())

#–¥–µ–ª–æ_—Ä–æ–∑–µ–Ω–±–µ—Ä–≥–æ–≤

async def show_rosenberg_case(update: Update, context: ContextTypes.DEFAULT_TYPE):
    chapter = game_data[15]
    keyboard = [
        [InlineKeyboardButton(choice["text"], callback_data=f"rosenberg_choice_{i}")]
        for i, choice in enumerate(chapter["choices"])
    ]
    keyboard.append([InlineKeyboardButton("‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')])

    await update.callback_query.edit_message_text(
        text=f"<b>{chapter['title']}</b>\n\n{chapter['description']}",
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup(keyboard)
    )

async def handle_rosenberg_choice(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    choice_idx = int(query.data.split('_')[-1])
    choice = game_data[15]["choices"][choice_idx]
    apply_effects(context, choice["effects"])
    context.user_data["year"] += 1

    if choice.get("is_final", False):
        await show_final_screen(update, context, outcome_key=choice.get("outcome_key", "soft_power_win"))
        return

    await query.edit_message_text(
        text=(
            f"<b>–†–µ–∑—É–ª—å—Ç–∞—Ç:</b>\n{choice['result']}\n\n"
            f"<b>–°–ª–µ–¥—É—é—â–µ–µ —Å–æ–±—ã—Ç–∏–µ:</b> {choice['next_event']}\n\n"
            f"<b>–¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:</b>\n{get_stats_display(context)}"
        ) + "\u200b",
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup([
            [InlineKeyboardButton("‚û°Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", callback_data=choice["next_event"].lower().replace(" ", "_"))],
            [InlineKeyboardButton("‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data="back_to_main")]
        ])
    )

async def show_history_rosenbergs(update: Update, context: ContextTypes.DEFAULT_TYPE):
    text = (
        "<b>–î–µ–ª–æ –†–æ–∑–µ–Ω–±–µ—Ä–≥–æ–≤ (1951)</b>\n\n"
        "–Æ–ª–∏—É—Å –∏ –≠—Ç–µ–ª—å –†–æ–∑–µ–Ω–±–µ—Ä–≥–∏ –±—ã–ª–∏ –æ–±–≤–∏–Ω–µ–Ω—ã –≤ –ø–µ—Ä–µ–¥–∞—á–µ –°–°–°–† —Å–µ–∫—Ä–µ—Ç–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —è–¥–µ—Ä–Ω–æ–π –±–æ–º–±–µ. "
        "–ò—Ö –∫–∞–∑–Ω—å –≤—ã–∑–≤–∞–ª–∞ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π —Ä–µ–∑–æ–Ω–∞–Ω—Å. –°–®–ê —É—Å–∏–ª–∏–ª–∏ –º–µ—Ä—ã –ø—Ä–æ—Ç–∏–≤ —Å–æ–≤–µ—Ç—Å–∫–æ–π —Ä–∞–∑–≤–µ–¥–∫–∏."
    )
    await update.callback_query.edit_message_text(text=text, parse_mode='HTML', reply_markup=back_to_history_menu())


#–æ—Ç—Å—Ç–∞–≤–∞–Ω–∏–µ_–≤_–≥–æ–Ω–∫–µ

async def show_fallbehind(update: Update, context: ContextTypes.DEFAULT_TYPE):
    chapter = game_data[16]
    keyboard = [
        [InlineKeyboardButton(choice["text"], callback_data=f"fallbehind_choice_{i}")]
        for i, choice in enumerate(chapter["choices"])
    ]
    keyboard.append([InlineKeyboardButton("‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')])

    await update.callback_query.edit_message_text(
        text=f"<b>{chapter['title']}</b>\n\n{chapter['description']}",
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup(keyboard)
    )

async def handle_fallbehind_choice(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    choice_idx = int(query.data.split('_')[-1])
    choice = game_data[16]["choices"][choice_idx]
    apply_effects(context, choice["effects"])
    context.user_data["year"] += 1

    if choice.get("is_final", False):
        await show_final_screen(update, context, outcome_key=choice.get("outcome_key", "stalemate"))
        return

    await query.edit_message_text(
        text=(
            f"<b>–†–µ–∑—É–ª—å—Ç–∞—Ç:</b>\n{choice['result']}\n\n"
            f"<b>–°–ª–µ–¥—É—é—â–µ–µ —Å–æ–±—ã—Ç–∏–µ:</b> {choice['next_event']}\n\n"
            f"<b>–¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:</b>\n{get_stats_display(context)}"
        ) + "\u200b",
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup([
            [InlineKeyboardButton("‚û°Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", callback_data=choice["next_event"].lower().replace(" ", "_"))],
            [InlineKeyboardButton("‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data="back_to_main")]
        ])
    )


#–∞–ª–±–∞–Ω—Å–∫–∏–π —Ä–∞—Å–∫–æ–ª
async def show_albanian_split(update: Update, context: ContextTypes.DEFAULT_TYPE):
    chapter = game_data[17]
    keyboard = [
        [InlineKeyboardButton(choice["text"], callback_data=f"albania_choice_{i}")]
        for i, choice in enumerate(chapter["choices"])
    ]
    keyboard.append([InlineKeyboardButton("‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')])

    await update.callback_query.edit_message_text(
        text=f"<b>{chapter['title']}</b>\n\n{chapter['description']}",
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup(keyboard)
    )

async def handle_albania_choice(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()

    choice_idx = int(query.data.split('_')[-1])
    chapter = game_data[17]
    choice = chapter["choices"][choice_idx]

    apply_effects(context, choice["effects"])
    context.user_data["year"] += 1

    if choice.get("is_final", False):
        await show_final_screen(update, context, outcome_key=choice.get("outcome_key", "fragmentation"))
        return

    await query.edit_message_text(
        text=(
            f"<b>–†–µ–∑—É–ª—å—Ç–∞—Ç:</b>\n{choice['result']}\n\n"
            f"<b>–°–ª–µ–¥—É—é—â–µ–µ —Å–æ–±—ã—Ç–∏–µ:</b> {choice['next_event']}\n\n"
            f"<b>–¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:</b>\n{get_stats_display(context)}"
        ) + "\u200b",
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup([
            [InlineKeyboardButton("‚û°Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", callback_data=choice['next_event'].lower().replace(" ", "_"))],
            [InlineKeyboardButton("‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data="back_to_main")]
        ])
    )

async def show_history_albania(update: Update, context: ContextTypes.DEFAULT_TYPE):
    text = (
        "<b>–ê–ª–±–∞–Ω—Å–∫–∏–π —Ä–∞—Å–∫–æ–ª (1950)</b>\n\n"
        "–ü–æ—Å–ª–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –°–°–°–† —Å –Æ–≥–æ—Å–ª–∞–≤–∏–µ–π, –ê–ª–±–∞–Ω–∏—è –æ–∫–∞–∑–∞–ª–∞—Å—å –º–µ–∂–¥—É –≤–ª–∏—è–Ω–∏–µ–º –ú–æ—Å–∫–≤—ã –∏ –ü–µ–∫–∏–Ω–∞. "
        "–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –°–°–°–† –æ—Å–ª–∞–±–ª–∞, –∏ –ê–ª–±–∞–Ω–∏—è –Ω–∞—á–∞–ª–∞ —Å–±–ª–∏–∂–µ–Ω–∏–µ —Å –ö–∏—Ç–∞–µ–º, —á—Ç–æ –ø—Ä–µ–¥–≤–æ—Å—Ö–∏—Ç–∏–ª–æ –±—É–¥—É—â–∏–π —Å–æ–≤–µ—Ç—Å–∫–æ-–∫–∏—Ç–∞–π—Å–∫–∏–π —Ä–∞–∑—Ä—ã–≤."
    )
    await update.callback_query.edit_message_text(text=text, parse_mode='HTML', reply_markup=back_to_history_menu())

async def show_history_menu(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ–Ω—é –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö —Å–ø—Ä–∞–≤–æ–∫"""
    chapter = game_data[99]
    await update.callback_query.edit_message_text(
        text=f"<b>{chapter['title']}</b>\n\n{chapter['description']}",
        parse_mode='HTML',
        reply_markup=get_choices_keyboard(chapter)
    )

async def button_handler(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–æ–∫"""
    query = update.callback_query
    await query.answer()

    if query.data == 'new_game':
        await show_churchill_scene(update, context)
    elif query.data == 'show_history':
        await show_history_menu(update, context)
    elif query.data == 'back_to_main':
        await back_to_main(update, context)
    elif query.data == 'potsdam_conference':
        await show_potsdam_conference(update, context)
    elif query.data == 'churchill_speech':
        await show_churchill_scene(update, context)
    elif query.data == 'history_spy':
        await show_spy_history(update, context)
    elif query.data == 'history_churchill':
        await show_churchill_history(update, context)
    elif query.data == 'history_potsdam':
        await show_potsdam_history(update, context)
    elif query.data.startswith('choice_churchill_'):
        await handle_churchill_choice(update, context)
    elif query.data.startswith('choice_'):
        await handle_potsdam_choice(update, context)
    elif query.data.startswith('spy_choice_'):
        await handle_spy_choice(update, context)
    elif query.data.startswith('berlin_choice_'):
        await handle_berlin_choice(update, context)
    elif query.data.startswith('history_berlin'):
        await show_berlin_history(update, context)
    elif query.data.startswith('marshall_choice_'):
        await handle_marshall_choice(update, context)
    elif query.data.startswith('cuban_choice_'):
        await handle_cuban_choice(update, context)
    elif query.data == 'history_cuban':
        await show_cuban_history(update, context)
    elif query.data.startswith('rds1_choice_'):
        await handle_rds1_choice(update, context)
    elif query.data == 'rds1_test':
        await show_rds1_test(update, context)
    elif query.data == 'proceed_to_rds1':
        await show_rds1_test(update, context)
    elif query.data == 'history_rds1':
        await show_rds1_history(update, context)
    elif query.data.startswith('venona_choice_'):
        await handle_venona_choice(update, context)
    elif query.data == '–æ–ø–µ—Ä–∞—Ü–∏—è_–≤–µ–Ω–æ–Ω–∞':
        await show_venona_operation(update, context)
    elif query.data == 'history_venona':
        await show_venona_history(update, context)
    elif query.data.startswith('nato_choice_'):
        await handle_nato_choice(update, context)
    elif query.data == '—Å–æ–∑–¥–∞–Ω–∏–µ_–Ω–∞—Ç–æ':
        await show_nato_creation(update, context)
    elif query.data.startswith('tito_choice_'):
        await handle_tito_choice(update, context)
    elif query.data == '—Ä–∞—Å–∫–æ–ª_—Å_—Ç–∏—Ç–æ':
        await show_tito_split(update, context)
    elif query.data == 'history_tito':
        await show_tito_history(update, context)
    elif query.data.startswith('testban_choice_'):
        await handle_testban_choice(update, context)
    elif query.data == '–¥–æ–≥–æ–≤–æ—Ä_–æ_–∑–∞–ø—Ä–µ—Ç–µ_–∏—Å–ø—ã—Ç–∞–Ω–∏–π':
        await show_test_ban_treaty(update, context)
    elif query.data == '—Å—Ç–æ–∫–≥–æ–ª—å–º—Å–∫–∞—è_–∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—è':
        await show_stockholm_conference(update, context)
    elif query.data == '–≤–µ–Ω–≥–µ—Ä—Å–∫–æ–µ_–≤–æ—Å—Å—Ç–∞–Ω–∏–µ':
        await show_hungarian_uprising(update, context)
    elif query.data.startswith('stockholm_choice_'):
        await handle_stockholm_choice(update, context)
    elif query.data.startswith('hungary_choice_'):
        await handle_hungary_choice(update, context)
    elif query.data.startswith('rosenberg_choice_'):
        await handle_rosenberg_choice(update, context)
    elif query.data.startswith('fallbehind_choice_'):
        await handle_fallbehind_choice(update, context)
    elif query.data == '–¥–µ–ª–æ_—Ä–æ–∑–µ–Ω–±–µ—Ä–≥–æ–≤':
        await show_rosenberg_case(update, context)
    elif query.data == '–æ—Ç—Å—Ç–∞–≤–∞–Ω–∏–µ_–≤_–≥–æ–Ω–∫–µ':
        await show_fallbehind(update, context)
    elif query.data.startswith('albania_choice_'):
        await handle_albania_choice(update, context)
    elif query.data == '–∞–ª–±–∞–Ω—Å–∫–∏–π_—Ä–∞—Å–∫–æ–ª':
        await show_albanian_split(update, context)
    elif query.data == 'berlin_crisis':
        await show_berlin_crisis(update, context)
    elif query.data == 'history_testban':
        await show_history_testban(update, context)
    elif query.data == 'history_stockholm':
        await show_history_stockholm(update, context)
    elif query.data == 'history_hungary':
        await show_history_hungary(update, context)
    elif query.data == 'history_rosenbergs':
        await show_history_rosenbergs(update, context)
    elif query.data == 'history_albania':
        await show_history_albania(update, context)


def get_stats_display(context):
    stats = context.user_data.get('stats', {})
    return (
        f"‚öîÔ∏è –í–æ–µ–Ω–Ω–∞—è –º–æ—â—å: {stats.get('military', 0)}\n"
        f"üè≠ –≠–∫–æ–Ω–æ–º–∏–∫–∞: {stats.get('economy', 0)}\n"
        f"‚ò¢Ô∏è –Ø–¥–µ—Ä–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏: {stats.get('nuclear_research', 0)}\n"
        f"üåç –í–ª–∏—è–Ω–∏–µ –≤ –ï–≤—Ä–æ–ø–µ: {stats.get('europe_influence', 0)}\n"
        f"üá∫üá∏ –û—Ç–Ω–æ—à–µ–Ω–∏—è —Å –°–®–ê: {stats.get('us_relations', 0)}"
    )

def back_to_history_menu():
    return InlineKeyboardMarkup([
        [InlineKeyboardButton("‚Ü©Ô∏è –ù–∞–∑–∞–¥ –∫ —Å–ø—Ä–∞–≤–∫–µ", callback_data='show_history')],
        [InlineKeyboardButton("‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
    ])


async def show_final_screen(update, context, outcome_key):
    await update.callback_query.answer()

    stats = context.user_data.get('stats', {})

    final_texts = {
        "global_war": (
            "üí• <b>–ì–ª–æ–±–∞–ª—å–Ω–∞—è –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞</b>\n\n"
            "–ú–∏—Ä –æ—Ö–≤–∞—á–µ–Ω —è–¥–µ—Ä–Ω–æ–π –≤–æ–π–Ω–æ–π. –•–æ–ª–æ–¥–Ω–∞—è –≤–æ–π–Ω–∞ –ø–µ—Ä–µ—à–ª–∞ –≤ –≥–æ—Ä—è—á—É—é —Ñ–∞–∑—É. "
            "–ú–∏–ª–ª–∏–æ–Ω—ã –∂–µ—Ä—Ç–≤. –°–°–°–† —É–Ω–∏—á—Ç–æ–∂–µ–Ω.\n\n"
            "<b>–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞.</b>"
            f"{get_stats_display(context)}"
        ),
        "end": (
            "<b>–ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞</b>\n\n"
            "–í—ã –ø—Ä–æ–∂–∏–ª–∏ –∫–ª—é—á–µ–≤—ã–µ –≥–æ–¥—ã –•–æ–ª–æ–¥–Ω–æ–π –≤–æ–π–Ω—ã –∏ –ø—Ä–∏–Ω—è–ª–∏ —Å—É–¥—å–±–æ–Ω–æ—Å–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è.\n\n"
            "<b>–ò—Ç–æ–≥–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:</b>\n"
            f"{get_stats_display(context)}"
        ),
        "military_dominance": (
            "üõ° <b>–°–°–°–† —Å—Ç–∞–ª —Å–≤–µ—Ä—Ö–¥–µ—Ä–∂–∞–≤–æ–π</b>\n\n"
            "–í—ã –¥–æ–±–∏–ª–∏—Å—å –≤–æ–µ–Ω–Ω–æ–≥–æ –ø—Ä–µ–≤–æ—Å—Ö–æ–¥—Å—Ç–≤–∞. –í–æ—Å—Ç–æ—á–Ω–∞—è –ï–≤—Ä–æ–ø–∞ –ø–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º, –ù–ê–¢–û –æ—Å–ª–∞–±–ª–µ–Ω–æ. "
            "–û–¥–Ω–∞–∫–æ –º–∏—Ä –∂–∏–≤—ë—Ç –≤ —Å—Ç—Ä–∞—Ö–µ –∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π —É–≥—Ä–æ–∑–µ –≤–æ–π–Ω—ã.\n\n"
            "<b>–í—ã –ø–æ–±–µ–¥–∏–ª–∏, –Ω–æ –∫–∞–∫–æ–π —Ü–µ–Ω–æ–π?</b>"
            f"{get_stats_display(context)}"
            ),
        "soft_power_win": (
            "üì£ <b>–ü–æ–±–µ–¥–∞ –∏–¥–µ–π</b>\n\n"
            "–í—ã –∏–∑–±–µ–∂–∞–ª–∏ –≤–æ–π–Ω—ã –∏ —É–±–µ–¥–∏–ª–∏ –º–∏—Ä –≤ –ø—Ä–µ–≤–æ—Å—Ö–æ–¥—Å—Ç–≤–µ —Å–æ—Ü–∏–∞–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö —Ü–µ–Ω–Ω–æ—Å—Ç–µ–π. "
            "–ö–æ–º–º—É–Ω–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∂–∏–º—ã —É–∫—Ä–µ–ø–∏–ª–∏—Å—å –ø–æ –≤—Å–µ–π –ï–≤—Ä–æ–ø–µ –∏ –ê–∑–∏–∏.\n\n"
            "<b>–ú–∏—Ä –ø–æ–≤–µ—Ä–∏–ª –≤ –≤–∞—à—É –¥–æ–∫—Ç—Ä–∏–Ω—É.</b>"
            f"{get_stats_display(context)}"
            ),
        "economic_decline": (
            "üìâ <b>–≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–µ –∏—Å—Ç–æ—â–µ–Ω–∏–µ</b>\n\n"
            "–°–°–°–† –Ω–∞ –≥—Ä–∞–Ω–∏ –∫–æ–ª–ª–∞–ø—Å–∞. –ù–∞—Ä–æ–¥ –±–µ–¥–µ–Ω, —Å–æ—é–∑–Ω–∏–∫–∏ –æ—Ç–¥–∞–ª—è—é—Ç—Å—è. "
            "–ê—Ä–º–∏—è —Å–∏–ª—å–Ω–∞, –Ω–æ —Å—Ç—Ä–∞–Ω–∞ ‚Äî –Ω–µ—Ç.\n\n"
            "<b>–í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏ –≥–æ–Ω–∫—É ‚Äî –±–µ–∑ –µ–¥–∏–Ω–æ–≥–æ –≤—ã—Å—Ç—Ä–µ–ª–∞.</b>"
            f"{get_stats_display(context)}"
            ),
        "fragmentation": (
            "üåç <b>–ò–º–ø–µ—Ä–∏—è —Ä–∞—Å–∫–æ–ª–æ—Ç–∞</b>\n\n"
            "–ü–æ—Å–ª–µ —Ä–∞—Å–∫–æ–ª–∞ —Å –¢–∏—Ç–æ –∏ –ö–∏—Ç–∞–µ–º —Å–æ—é–∑ —Å–æ—Ü–∏–∞–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö —Å—Ç—Ä–∞–Ω —Ä–∞—Å–ø–∞–ª—Å—è. "
            "–°–°–°–† –æ—Å—Ç–∞–ª—Å—è –≤ –∏–∑–æ–ª—è—Ü–∏–∏, —É—Ç—Ä–∞—Ç–∏–≤ –≤–ª–∏—è–Ω–∏–µ.\n\n"
            "<b>–í—ã –ø–æ—Ç–µ—Ä—è–ª–∏ –º–∏—Ä, –∫–æ—Ç–æ—Ä—ã–π –ø—ã—Ç–∞–ª–∏—Å—å –ø–æ—Å—Ç—Ä–æ–∏—Ç—å.</b>"
            f"{get_stats_display(context)}"
            ),
        "stalemate": (
            "üïä <b>–•—Ä—É–ø–∫–∏–π –º–∏—Ä</b>\n\n"
            "–í—ã –∏–∑–±–µ–∂–∞–ª–∏ —è–¥–µ—Ä–Ω–æ–π –≤–æ–π–Ω—ã. –ù–æ –Ω–∏ –ø–æ–±–µ–¥—ã, –Ω–∏ –ø–æ—Ä–∞–∂–µ–Ω–∏—è. "
            "–•–æ–ª–æ–¥–Ω–∞—è –≤–æ–π–Ω–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –≤ –∑–∞–º–æ—Ä–æ–∂–µ–Ω–Ω–æ–º –≤–∏–¥–µ.\n\n"
            "<b>–ò—Å—Ç–æ—Ä–∏—è –µ—â—ë –Ω–µ –∑–∞–∫–æ–Ω—á–µ–Ω–∞.</b>"
            f"{get_stats_display(context)}"
            ),
    }

    message = final_texts.get(outcome_key, final_texts["end"])

    await update.callback_query.edit_message_text(
        text=message + "\u200b",
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup([
            [InlineKeyboardButton("üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ", callback_data='new_game')],
            [InlineKeyboardButton("‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
        ])
    )



async def show_welcome(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ–Ω—é –≤—ã–±–æ—Ä–∞ —Å—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ —Å–æ–±—ã—Ç–∏—è"""
    chapter = game_data[1]
    await update.callback_query.edit_message_text(
        text=chapter['welcome_message'],
        reply_markup=get_choices_keyboard(chapter)
    )


def get_choices_keyboard(chapter):
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –≤—ã–±–æ—Ä–∞"""
    buttons = [
        [InlineKeyboardButton(choice["text"], callback_data=choice.get("callback", f"choice_{i}"))]
        for i, choice in enumerate(chapter['choices'])
    ]
    return InlineKeyboardMarkup(buttons)


async def handle_choice(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä –∏–≥—Ä–æ–∫–∞"""
    query = update.callback_query
    await query.answer()

    await query.edit_message_text(
        text="–í—ã–±–æ—Ä –ø—Ä–∏–Ω—è—Ç!",
        reply_markup=InlineKeyboardMarkup([
            [InlineKeyboardButton("–ù–∞–∑–∞–¥", callback_data='back_to_main')]
        ])
    )


async def back_to_main(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–í–æ–∑–≤—Ä–∞—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"""
    await update.callback_query.edit_message_text(
        text="–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:",
        reply_markup=main_menu_keyboard()
    )


async def error_handler(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫"""
    logger.error(msg="Exception while handling an update:", exc_info=context.error)
    if update.effective_message:
        await update.effective_message.reply_text("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.")

def apply_effects(context, effects):
    for stat, value in effects.items():
        context.user_data['stats'][stat] = context.user_data['stats'].get(stat, 0) + value


def main() -> None:
    """–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞"""
    application = Application.builder().token(os.getenv("TELEGRAM_TOKEN")).build()

    application.add_error_handler(error_handler)
    application.add_handler(CommandHandler("start", start))
    application.add_handler(CallbackQueryHandler(button_handler))

    if os.getenv("DEV_MODE"):
        application.run_polling()
    else:
        application.run_webhook()


if __name__ == '__main__':
    main()